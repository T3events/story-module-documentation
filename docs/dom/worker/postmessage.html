<h1>Worker.postMessage</h1> <p>The <code><strong>postMessage()</strong></code> method of the <a title="The Worker interface of the Web Workers API represents a background task that can be easily created and can send messages back to its creator. Creating a worker is as simple as calling the Worker() constructor and specifying a script to be run in the worker thread." href="../worker"><code>Worker</code></a> interface sends a message to the worker's inner scope. This accepts a single parameter, which is the data to send to the worker. The data may be any value or JavaScript object handled by the <a title="http://www.whatwg.org/specs/web-apps/current-work/multipage/common-dom-interfaces.html#transferable" href="https://developer.mozilla.org/en-US/docs/Web/Guide/DOM/The_structured_clone_algorithm">structured clone</a> algorithm, which includes cyclical references.</p> <p>The <code>Worker</code> can send back information to the thread that spawned it using the <a title="The postMessage() method of the DedicatedWorkerGlobalScope interface sends a message to the main thread that spawned it. This accepts a single parameter, which is the data to send to the worker. The data may be any value or JavaScript object handled by the structured clone algorithm, which includes cyclical references." href="../dedicatedworkerglobalscope/postmessage"><code>DedicatedWorkerGlobalScope.postMessage</code></a> method.</p> <h2 id="Syntax">Syntax</h2> <pre data-language="js">myWorker.postMessage(aMessage, transferList);</pre> <h3 id="Parameters">Parameters</h3> <dl> <dt><em>aMessage</em></dt> <dd>The object to deliver to the worker; this will be in the data field in the event delivered to the <a title="The onmessage property of the DedicatedWorkerGlobalScope interface represents an EventHandler to be called when the message event occurs and bubbles through the Worker — i.e. when a message is sent to the worker using the Worker.postMessage method." href="../dedicatedworkerglobalscope/onmessage"><code>DedicatedWorkerGlobalScope.onmessage</code></a> handler. This may be any value or JavaScript object handled by the <a title="http://www.whatwg.org/specs/web-apps/current-work/multipage/common-dom-interfaces.html#transferable" href="https://developer.mozilla.org/en-US/docs/Web/Guide/DOM/The_structured_clone_algorithm">structured clone</a> algorithm, which includes cyclical references.</dd> <dt>
<em>transferList</em> <span class="inlineIndicator optional optionalInline">Optional</span>
</dt> <dd>An optional <a title="/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">array</a> of <a title="The Transferable interface represents an object that can be transfered between different execution contexts, like the main thread and Web workers." href="../transferable"><code>Transferable</code></a> objects to transfer ownership of. If the ownership of an object is transferred, it becomes unusable (<em>neutered</em>) in the context it was sent from and becomes available only to the worker it was sent to.</dd> <dd>Transferable objects are instances of classes like <a title="The documentation about this has not yet been written; please consider contributing!" href="https://developer.mozilla.org/en-US/docs/Web/API/ArrayBuffer"><code>ArrayBuffer</code></a>, <a title="The MessagePort interface of the Channel Messaging API represents one of the two ports of a MessageChannel, allowing sending of messages from one port and listening out for them arriving at the other." href="../messageport"><code>MessagePort</code></a> or <a title="The ImageBitmap interface represents a bitmap image which can be drawn to a &lt;canvas&gt; without undue latency. It can be created from a variety of source objects using the createImageBitmap() factory method. ImageBitmap provides an asynchronous and resource efficient pathway to prepare textures for rendering in WebGL." href="../imagebitmap"><code>ImageBitmap</code></a> objects can be transferred. <code>null</code> is not an acceptable value for the <code>transferList</code>.</dd> </dl> <h3 id="Returns">Returns</h3> <p>Void.</p> <h2 id="Example">Example</h2> <p>The following code snippet shows the creation of a <a title="The Worker interface of the Web Workers API represents a background task that can be easily created and can send messages back to its creator. Creating a worker is as simple as calling the Worker() constructor and specifying a script to be run in the worker thread." href="../worker"><code>Worker</code></a> object using the <a title="The Worker() constructor creates a Worker object that executes the script at the specified URL. This script must obey the same-origin policy." href="worker"><code>Worker()</code></a> constructor. When either of two form inputs (<code>first</code> and <code>second</code>) have their values changed, <code><a title="/en-US/docs/Web/Events/change" href="https://developer.mozilla.org/en-US/docs/Web/Events/change">change</a></code> events invoke <code>postMessage()</code> to send the value of both inputs to the current worker.</p> <pre data-language="js">var myWorker = new Worker('worker.js');

first.onchange = function() {
  myWorker.postMessage([first.value,second.value]);
  console.log('Message posted to worker');
}

second.onchange = function() {
  myWorker.postMessage([first.value,second.value]);
  console.log('Message posted to worker');
}
</pre> <p>For a full example, see our<a href="https://github.com/mdn/simple-web-worker" class="external external-icon">Basic dedicated worker example</a> (<a href="http://mdn.github.io/simple-web-worker/" class="external external-icon">run dedicated worker</a>).</p> <div class="note"> <p><strong>Note</strong>: <code>postMessage()</code> can only send a single object at once. As seen above, if you want to pass multiple values you can send an array.</p> </div> <h3 id="Transfer_Example">Transfer Example</h3> <p>This example shows a Firefox add-on that transfers an <code>ArrayBuffer</code> from the main thread to the <code>ChromeWorker</code>, and then the <code>ChromeWorker</code> transfers it back to the main thread.</p> <h4 id="Main_thread_code">Main thread code:</h4> <pre data-language="js">var myWorker = new ChromeWorker(self.path + 'myWorker.js');

function handleMessageFromWorker(msg) {
    console.log('incoming message from worker, msg:', msg);
    switch (msg.data.aTopic) {
        case 'do_sendMainArrBuff':
            sendMainArrBuff(msg.data.aBuf)
            break;
        default:
            throw 'no aTopic on incoming message to ChromeWorker';
    }
}

myWorker.addEventListener('message', handleMessageFromWorker);

// Ok lets create the buffer and send it
var arrBuf = new ArrayBuffer(8);
console.info('arrBuf.byteLength pre transfer:', arrBuf.byteLength);

myWorker.postMessage(
    {
        aTopic: 'do_sendWorkerArrBuff',
        aBuf: arrBuf // The array buffer that we passed to the transferrable section 3 lines below
    },
    [
        arrBuf // The array buffer we created 9 lines above
    ]
); 

console.info('arrBuf.byteLength post transfer:', arrBuf.byteLength);
</pre> <h4 id="Worker_code">Worker code</h4> <pre data-language="js">self.onmessage = function (msg) {
    switch (msg.data.aTopic) {
        case 'do_sendWorkerArrBuff':
                sendWorkerArrBuff(msg.data.aBuf)
            break;
        default:
            throw 'no aTopic on incoming message to ChromeWorker';
    }
}

function sendWorkerArrBuff(aBuf) {
    console.info('from worker, PRE send back aBuf.byteLength:', aBuf.byteLength);    

    self.postMessage({aTopic:'do_sendMainArrBuff', aBuf:aBuf}, [aBuf]);

    console.info('from worker, POST send back aBuf.byteLength:', aBuf.byteLength);
}
</pre> <h4 id="Output_logged">Output logged</h4> <pre>arrBuf.byteLength pre transfer: 8                              bootstrap.js:40
arrBuf.byteLength post transfer: 0                             bootstrap.js:42

from worker, PRE send back aBuf.byteLength: 8                  myWorker.js:5:2

incoming message from worker, msg: message { ... }             bootstrap.js:20
got back buf in main thread, aBuf.byteLength: 8                bootstrap.js:12

from worker, POST send back aBuf.byteLength: 0                 myWorker.js:7:2</pre> <p><code>byteLength</code> goes to 0 as it is transferred. To see a full working example of this Firefox demo add-on see here: <a href="https://github.com/Noitidart/ChromeWorker/tree/aca57d9cadc4e68af16201bdecbfb6f9a6f9ca6b">GitHub :: ChromeWorker - demo-transfer-arraybuffer</a></p> <h2 id="Specifications">Specifications</h2> <table class="standard-table"> <tbody> <tr> <th scope="col">Specification</th> <th scope="col">Status</th> <th scope="col">Comment</th> </tr> <tr> <td><a lang="en" hreflang="en" href="https://html.spec.whatwg.org/multipage/#dom-worker-postmessage" class="external">WHATWG HTML Living Standard<br><small lang="en-US">The definition of 'Worker.postMessage()' in that specification.</small></a></td> <td><span class="spec-Living">Living Standard</span></td> <td>No change from <a lang="en" hreflang="en" class="external" href="https://w3c.github.io/workers/" title="The 'Web Workers' specification">Web Workers</a>.</td> </tr> <tr> <td><a lang="en" hreflang="en" href="https://w3c.github.io/workers/#dom-worker-postmessage" class="external">Web Workers<br><small lang="en-US">The definition of 'Worker.postMessage()' in that specification.</small></a></td> <td><span class="spec-ED">Editor's Draft</span></td> <td>Initial definition.</td> </tr> </tbody> </table> <h2 id="Browser_compatibility">Browser compatibility</h2>  <div id="compat-desktop"> <table class="compat-table"> <tbody> <tr> <th>Feature</th> <th>Chrome</th> <th>Firefox (Gecko)</th> <th>Internet Explorer</th> <th>Opera</th> <th>Safari (WebKit)</th> </tr> <tr> <td>Basic support</td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td>10.0 [1]</td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> </tr> </tbody> </table> </div> <div id="compat-mobile"> <table class="compat-table"> <tbody> <tr> <th>Feature</th> <th>Android</th> <th>Firefox Mobile (Gecko)</th> <th>Firefox OS (Gecko)</th> <th>IE Phone</th> <th>Opera Mobile</th> <th>Safari Mobile</th> </tr> <tr> <td>Basic support</td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td>10.0 [1]</td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> </tr> </tbody> </table> </div> <p>[1] Internet Explorer does not support <a title="The Transferable interface represents an object that can be transfered between different execution contexts, like the main thread and Web workers." href="../transferable"><code>Transferable</code></a> objects.</p> <h2 id="See_also">See also</h2> <ul> <li>The <a title="The Worker interface of the Web Workers API represents a background task that can be easily created and can send messages back to its creator. Creating a worker is as simple as calling the Worker() constructor and specifying a script to be run in the worker thread." href="../worker"><code>Worker</code></a> interface it belongs to.</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker/postMessage$edit" class="_attribution-link">Edit this page on MDN</a>
  </p>
</div>
<div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2017 Mozilla Developer Network and individual contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker/postMessage" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/Worker/postMessage</a>
  </p>
</div>
