<h1>MediaDevices.ondevicechange</h1> <p><span class="seoSummary">The <strong><code>MediaDevices.ondevicechange</code></strong> property is an <a title="A possible way to get notified of Events of a particular type (such as click) for a given object is to specify an event handler using:" href="https://developer.mozilla.org/en-US/docs/Web/API/EventHandler"><code>EventHandler</code></a> which specifies a function to be called when the <code><a title="/en-US/docs/Web/Events/devicechange" href="https://developer.mozilla.org/en-US/docs/Web/Events/devicechange">devicechange</a></code> event occurs on a <a title="The MediaDevices interface provides access to connected media input devices like cameras and microphones, as well as screen sharing. In essence, it lets you obtain access to any hardware source of media data." href="../mediadevices"><code>MediaDevices</code></a> instance. This happens whenever the set of media devices available to the <a title="user agent: A user agent is a computer program representing a person, for example, a browser in a Web context." href="https://developer.mozilla.org/en-US/docs/Glossary/user_agent" class="glossaryLink">user agent</a> and, by extension, to the web site or app has changed. You can at any time use <a title="The MediaDevices.enumerateDevices() method collects information about the media input and output devices available on the system." href="enumeratedevices"><code>enumerateDevices()</code></a> to get the updated list of available devices.</span></p> <h2 id="Syntax">Syntax</h2> <pre class="syntaxbox"><em>MediaDevices</em>.ondevicechange = <em>eventHandler</em>;
</pre> <h3 id="Value">Value</h3> <p>A function you provide which accepts as input a <a title="The Event interface represents any event which takes place in the DOM; some are user-generated (such as mouse or keyboard events), while others are generated by APIs (such as events that indicate an animation has finished running, a video has been paused, and so forth). There are many types of event, some of which use are other interfaces based on the main Event interface. Event itself contains the properties and methods which are common to all events." href="../event"><code>Event</code></a> object describing the <a title="The documentation about this has not yet been written; please consider contributing!" href="https://developer.mozilla.org/en-US/docs/Web/API/Devicehange"><code>devicehange</code></a> event that occurred. There is no information about the change included in the event object; to get the updated list of devices, you'll have to use <a title="The MediaDevices.enumerateDevices() method collects information about the media input and output devices available on the system." href="enumeratedevices"><code>enumerateDevices()</code></a>.</p> <h2 name="Example" id="Example">Example</h2> <p>In this example, we create a function called <code>updateDeviceList()</code>, which is called once when <a title="The MediaDevices.getUserMedia() method prompts the user for permission to use one video and/or one audio input device such as a camera or screensharing and/or a microphone. If the user provides permission, then the returned Promise is resolved with the resulting MediaStream object. If the user denies permission, or media is not available, then the promise is rejected with PermissionDeniedError or NotFoundError respectively. Note that it is possible for the returned promise to neither resolve nor reject, as the user is not required to make a choice." href="getusermedia"><code>MediaDevices.getUserMedia()</code></a> successfully obtains a stream, and then is called any time the device list changes. It displays in the browser window two lists: one of audio devices and one of video devices, with both the device's label (name) and whether it's an input or an output device. Because the example provides a handler for the <code><a title="/en-US/docs/Web/Events/devicechange" href="https://developer.mozilla.org/en-US/docs/Web/Events/devicechange">devicechange</a></code> event, the list is refreshed any time a media device is attached to or removed from the device running the sample.</p>  <p>We set up global variables that contain references to the <a title="The HTML &lt;ul&gt; element represents an unordered list of items, typically rendered as a bulleted list." href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ul"><code>&lt;ul&gt;</code></a> elements that are used to list the audio and video devices:</p> <pre data-language="js">let audioList = document.getElementById("audioList");
let videoList = document.getElementById("videoList");</pre> <h4 id="Getting_and_drawing_the_device_list">Getting and drawing the device list</h4> <p>Now let's take a look at <code>updateDeviceList()</code> itself. This method is called any time we want to fetch the current list of media devices and then update the displayed lists of audo and video devices using that information.</p> <pre data-language="js">function updateDeviceList() {
  navigator.mediaDevices.enumerateDevices()
  .then(function(devices) {
    audioList.innerHTML = "";
    videoList.innerHTML = "";
    
    devices.forEach(function(device) {
      let elem = document.createElement("li");      
      let [kind, type, direction] = device.kind.match(/(\w+)(input|output)/i);
      
      elem.innerHTML = "&lt;strong&gt;" + device.label + "&lt;/strong&gt; (" + direction + ")";
      if (type === "audio") {
        audioList.appendChild(elem);
      } else if (type === "video") {
        videoList.appendChild(elem);
      }
    });
  });
}</pre> <p><code>updateDeviceList()</code> consists entirely of a call to the function <a title="The MediaDevices.enumerateDevices() method collects information about the media input and output devices available on the system." href="enumeratedevices"><code>enumerateDevices()</code></a> on the <a title="The MediaDevices interface provides access to connected media input devices like cameras and microphones, as well as screen sharing. In essence, it lets you obtain access to any hardware source of media data." href="../mediadevices"><code>MediaDevices</code></a> object referenced in the <a title="The Navigator.mediaDevices read-only property returns a MediaDevices object, which provides access to connected media input devices like cameras and microphones, as well as screen sharing." href="../navigator/mediadevices"><code>navigator.mediaDevices</code></a> property, as well as the code that's run when the <a title="The Promise object is used for asynchronous computations. A Promise represents a value which may be available now, or in the future, or never." href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/promise"><code>promise</code></a> returned by <code>enumerateDevices()</code> is fulfilled. The fulfillment handler is called when the device list is ready. The list is passed into the fulfillment handler as an array of <a title="The MediaDevicesInfo interface contains information on the available media input and output devices." href="../mediadeviceinfo"><code>MediaDeviceInfo</code></a> objects, each describing one media input or output device.</p> <p>A <a title="The forEach() method executes a provided function once for each array element." href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach"><code>forEach()</code></a> loop is used to scan through all the devices. For each device, we create a new <a title="The HTML &lt;li&gt; element is used to represent an item in a list. It must be contained in a parent element: an ordered list (&lt;ol&gt;), an unordered list (&lt;ul&gt;), or a menu (&lt;menu&gt;). In menus and unordered lists, list items are usually displayed using bullet points. In ordered lists, they are usually displayed with an ascending counter on the left, such as a number or letter." href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/li"><code>&lt;li&gt;</code></a> object to be used to display it to the user.</p> <p>The line <code>let [kind, type, direction] = device.kind.match(/(\w+)(input|output)/i);</code> deserves special notice. This uses <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">destructuring assignment</a> (a new feature of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/New_in_JavaScript/ECMAScript_6_support_in_Mozilla">ECMAScript 6</a>) to assign the values of the first three items in the array returned by <a title="The match() method retrieves the matches when matching a string against a regular expression." href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/match"><code>String.match()</code></a> to the variables <code>kind</code>, <code>type</code>, and <code>direction</code>. We do this because the value of <a title='The kind readonly property of the MediaDeviceInfo interface returns an enumerated value that is either "videoinput", "audioinput" or "audiooutput".' href="../mediadeviceinfo/kind"><code>MediaDeviceInfo.kind</code></a> is a single string that includes both the media type and the direction the media flows, such as "audioinput" or "videooutput". This line, then, pulls out the type ("audio" or "video") and direction ("input" or "output") so they can be used to construct the string displayed in the list.</p> <p>Once the string is assembled, containing the device's name in bold and the direction in parentheses, it's appended to the appropriate list by calling <a title="The Node.appendChild() method adds a node to the end of the list of children of a specified parent node. If the given child is a reference to an existing node in the document, appendChild() moves it from its current position to the new position (there is no requirement to remove the node from its parent node before appending it to some other node)." href="../node/appendchild"><code>appendChild()</code></a> on either <code>audioList</code> or <code>videoList</code>, as appropriate based on the device type.</p> <h4 id="Handling_device_list_changes">Handling device list changes</h4> <p>We call <code>updateDeviceList()</code> in two places. The first is in the <a title="The MediaDevices.getUserMedia() method prompts the user for permission to use one video and/or one audio input device such as a camera or screensharing and/or a microphone. If the user provides permission, then the returned Promise is resolved with the resulting MediaStream object. If the user denies permission, or media is not available, then the promise is rejected with PermissionDeniedError or NotFoundError respectively. Note that it is possible for the returned promise to neither resolve nor reject, as the user is not required to make a choice." href="getusermedia"><code>getUserMedia()</code></a> promise's fulfillment handler, to initially fill out the list when the stream is opened. The second is in the event handler for <code><a title="/en-US/docs/Web/Events/devicechange" href="https://developer.mozilla.org/en-US/docs/Web/Events/devicechange">devicechange</a></code>:</p> <pre data-language="js">navigator.mediaDevices.ondevicechange = function(event) {
  updateDeviceList();
}</pre> <p>With this code in place, each time the user plugs in a camera, microphone, or other media device, or turns one on or off, we call <code>updateDeviceList()</code> to redraw the list of connected devices.</p> <h3 id="Result">Result</h3> <p><iframe width="600" frameborder="0" id="frame_Example" src="https://mdn.mozillademos.org/en-US/docs/Web/API/MediaDevices/ondevicechange%24samples/Example?revision=1178855" height="460" class="live-sample-frame sample-code-frame"></iframe></p> <h2 id="Specifications">Specifications</h2> <table class="standard-table"> <thead> <tr> <th scope="col">Specification</th> <th scope="col">Status</th> <th scope="col">Comment</th> </tr> </thead> <tbody> <tr> <td><a lang="en" hreflang="en" href="http://w3c.github.io/mediacapture-main/#dom-mediadevices-ondevicechange" class="external">Media Capture and Streams<br><small lang="en-US">The definition of 'ondevicechange' in that specification.</small></a></td> <td><span class="spec-ED">Editor's Draft</span></td> <td>Initial specification.</td> </tr> </tbody> </table> <h2 id="Browser_compatibility">Browser compatibility</h2>  <div id="compat-desktop"> <table class="compat-table"> <tbody> <tr> <th>Feature</th> <th>Chrome</th> <th>Firefox (Gecko)</th> <th>Internet Explorer</th> <th>Opera</th> <th>Safari (WebKit)</th> </tr> <tr> <td>Basic support</td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td>
<a title="Released on 2017-01-24." href="https://developer.mozilla.org/en-US/Firefox/Releases/51">51</a> (51)</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> </tr> </tbody> </table> </div> <div id="compat-mobile"> <table class="compat-table"> <tbody> <tr> <th>Feature</th> <th>Android</th> <th>Android Webview</th> <th>Firefox Mobile (Gecko)</th> <th>IE Phone</th> <th>Opera Mobile</th> <th>Safari Mobile</th> <th>Chrome for Android</th> </tr> <tr> <td>Basic support</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span style="color: #f00;">No support</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> </tr> </tbody> </table> </div> <p>[1] Support for the <code>devicechange</code> event and for <a title="The MediaDevices.ondevicechange property is an EventHandler which specifies a function to be called when the devicechange event occurs on a MediaDevices instance. This happens whenever the set of media devices available to the user agent and, by extension, to the web site or app. You can at any time use enumerateDevices() to get the updated list of available devices." href="ondevicechange"><code>MediaDevices.ondevicechange</code></a> landed in Firefox 51, but <em>only for Mac</em>, and disabled by default. It can be enabled by setting the preference <code>media.ondevicechange.enabled</code> to <code>true</code>. Support for this event was added for Linux and Windows—and it was enabled by default—starting in Firefox 52.</p> <h2 id="See_also">See also</h2> <ul> <li>The <code><a title="/en-US/docs/Web/Events/devicechange" href="https://developer.mozilla.org/en-US/docs/Web/Events/devicechange">devicechange</a></code> event and its type, <a title="The Event interface represents any event which takes place in the DOM; some are user-generated (such as mouse or keyboard events), while others are generated by APIs (such as events that indicate an animation has finished running, a video has been paused, and so forth). There are many types of event, some of which use are other interfaces based on the main Event interface. Event itself contains the properties and methods which are common to all events." href="../event"><code>Event</code></a>.</li> <li><a title="The MediaDevices.enumerateDevices() method collects information about the media input and output devices available on the system." href="enumeratedevices"><code>MediaDevices.enumerateDevices()</code></a></li> <li><a title="The MediaDevicesInfo interface contains information on the available media input and output devices." href="../mediadeviceinfo"><code>MediaDeviceInfo</code></a></li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/ondevicechange$edit" class="_attribution-link">Edit this page on MDN</a>
  </p>
</div>
<div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2017 Mozilla Developer Network and individual contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/ondevicechange" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/ondevicechange</a>
  </p>
</div>
