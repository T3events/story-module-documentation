<h1>Web Storage API: Using the Web Storage API</h1><div class="summary"> <p>The Web Storage API provides mechanisms by which browsers can securely store key/value pairs, in a much more intuitive fashion than using cookies. This article provides a walkthrough of how to make use of this simple technology.</p> </div> <h2 id="Basic_concepts">Basic concepts</h2> <p>Storage objects are simple key-value stores, similar to objects, but they stay intact through page loads. The keys and the values are always strings (note that integer keys will be automatically converted to strings, just like what objects do). You can access these values like an object, or with the getItem() and setItem() methods. These three lines all set the colorSetting entry in the same way:</p> <pre>localStorage.colorSetting = '#a4509b';
localStorage['colorSetting'] = '#a4509b';
localStorage.setItem('colorSetting', '#a4509b');
</pre> <div class="note"> <p><strong>Note</strong>: It's recommended to use the Web Storage API (<code>setItem</code>, <code>getItem,</code> <code>removeItem, key, length) to prevent the <a href="http://www.2ality.com/2012/01/objects-as-maps.html">pitfalls</a> associated with using plain objects as key-value stores.</code></p> </div> <p>The two mechanisms within Web Storage are as follows:</p> <ul> <li>
<strong><code>sessionStorage</code> </strong>maintains a separate storage area for each given origin that's available for the duration of the page session (as long as the browser is open, including page reloads and restores).</li> <li>
<strong><code>localStorage</code> </strong>does the same thing, but persists even when the browser is closed and reopened.</li> </ul> <p>These mechanisms are available via the <a title="The sessionStorage property allows you to access a session Storage object for the current origin. sessionStorage is similar to Window.localStorage, the only difference is while data stored in localStorage has no expiration set, data stored in sessionStorage gets cleared when the page session ends. A page session lasts for as long as the browser is open and survives over page reloads and restores. Opening a page in a new tab or window will cause a new session to be initiated, which differs from how session cookies work." href="../window/sessionstorage"><code>Window.sessionStorage</code></a> and <a title="The localStorage property allows you to access a local Storage object. localStorage is similar to sessionStorage. The only difference is that, while data stored in localStorage has no expiration time, data stored in sessionStorage gets cleared when the browsing session ends—that is, when the browser is closed." href="../window/localstorage"><code>Window.localStorage</code></a> properties (to be more precise, in supporting browsers the <code>Window</code> object implements the <code>WindowLocalStorage</code> and <code>WindowSessionStorage</code> objects, which the <code>localStorage</code> and <code>sessionStorage</code> properties hang off) — invoking one of these will create an instance of the <a title="The Storage interface of the Web Storage API provides access to the session storage or local storage for a particular domain, allowing you to for example add, modify or delete stored data items." href="../storage"><code>Storage</code></a> object, through which data items can be set, retrieved, and removed. A different Storage object is used for the <code>sessionStorage</code> and <code>localStorage</code> for each origin — they function and are controlled separately.</p> <p>So, for example, initially calling <code>localStorage</code> on a document will return a <a title="The Storage interface of the Web Storage API provides access to the session storage or local storage for a particular domain, allowing you to for example add, modify or delete stored data items." href="../storage"><code>Storage</code></a> object; calling <code>sessionStorage</code> on a document will return a different <a title="The Storage interface of the Web Storage API provides access to the session storage or local storage for a particular domain, allowing you to for example add, modify or delete stored data items." href="../storage"><code>Storage</code></a> object. Both of these can be manipulated in the same way, but separately.</p> <h2 id="Feature-detecting_localStorage">Feature-detecting localStorage</h2> <p>To be able to use localStorage, we should first verify that it is supported and available in the current browsing session.</p> <h3 id="Testing_for_support_vs_availability">Testing for support vs availability</h3> <p>Browsers that support localStorage will have a property on the window object named localStorage. However, for various reasons, just asserting that property exists may throw exceptions. If it does exist, that is still no guarantee that localStorage is actually available, as various browsers offer settings that disable localStorage. So a browser may <em>support</em> localStorage, but not make it <em>available</em> to the scripts on the page. One example of that is Safari, which in Private Browsing mode gives us an empty localStorage object with a quota of zero, effectively making it unusable. Our feature detect should take these scenarios into account. </p> <p>Here is a function that detects whether localStorage is both supported and available:</p> <pre>function storageAvailable(type) {
	try {
		var storage = window[type],
			x = '__storage_test__';
		storage.setItem(x, x);
		storage.removeItem(x);
		return true;
	}
	catch(e) {
		return false;
	}
}</pre> <p>And here is how you would use it:</p> <pre>if (storageAvailable('localStorage')) {
	// Yippee! We can use localStorage awesomeness
}
else {
	// Too bad, no localStorage for us
}</pre> <p>You can test for sessionStorage instead by calling <code>storageAvailable('sessionStorage')</code>. </p> <p>See here for a <a href="https://gist.github.com/paulirish/5558557">brief history of feature-detecting localStorage</a>.</p> <h2 id="A_simple_example">A simple example</h2> <p>To illustrate some typical web storage usage, we have created a simple example, imaginatively called <strong>Web Storage Demo</strong>. The <a href="https://mdn.github.io/dom-examples/web-storage/">landing page</a> provides controls that can be used to customize the color, font, and decorative image:</p> <p><img src="https://mdn.mozillademos.org/files/9685/landing.png" alt="" style="display: block; height: 482px; margin: 0px auto; width: 700px;">When you choose different options, the page is instantly updated; in addition, your choices are stored in <code>localStorage</code>, so that when you leave the page and load it again later on, your choices are remembered.</p> <p>We have also provided an <a href="https://mdn.github.io/dom-examples/web-storage/event.html">event output page</a> — if you load this page in another tab, then make changes to your choices in the landing page, you'll see the updated storage information outputted as a <a title="A StorageEvent is sent to a window when a storage area changes." href="../storageevent"><code>StorageEvent</code></a> is fired.</p> <p><img src="https://mdn.mozillademos.org/files/9687/event-output.png" alt="" style="display: block; height: 482px; margin: 0px auto; width: 700px;"></p> <div class="note"> <p><strong>Note</strong>: As well as viewing the example pages live using the above links, you can also <a href="https://github.com/mdn/dom-examples/tree/master/web-storage">check out the source code</a>.</p> </div> <h2 id="Testing_whether_your_storage_has_been_populated">Testing whether your storage has been populated</h2> <p>To start with on <a href="https://github.com/mdn/web-storage-demo/blob/gh-pages/main.js">main.js</a>, we will test whether the storage object has already been populated (i.e., the page was previously accessed):</p> <pre data-language="js">if(!localStorage.getItem('bgcolor')) {
  populateStorage();
} else {
  setStyles();
}</pre> <p>The <a title="The getItem() method of the Storage interface, when passed a key name, will return that key's value." href="../storage/getitem"><code>Storage.getItem()</code></a> method is used to get a data item from storage; in this case we are testing to see whether the <code>bgcolor</code> item exists; if not, we run <code>populateStorage()</code> to add the existing customization values to the storage. If there are already values there, we run <code>setStyles()</code> to update the page styling with the stored values.</p> <p><strong>Note</strong>: You could also use <a title="The length read-only property of the Storage interface returns an integer representing the number of data items stored in the Storage object." href="../storage/length"><code>Storage.length</code></a> to test whether the storage object is empty or not.</p> <h2 id="Getting_values_from_storage">Getting values from storage</h2> <p>As noted above, values can be retrieved from storage using <a title="The getItem() method of the Storage interface, when passed a key name, will return that key's value." href="../storage/getitem"><code>Storage.getItem()</code></a>. This takes the key of the data item as an argument, and returns the data value. For example:</p> <pre data-language="js">function setStyles() {
  var currentColor = localStorage.getItem('bgcolor');
  var currentFont = localStorage.getItem('font');
  var currentImage = localStorage.getItem('image');

  document.getElementById('bgcolor').value = currentColor;
  document.getElementById('font').value = currentFont;
  document.getElementById('image').value = currentImage;

  htmlElem.style.backgroundColor = '#' + currentColor;
  pElem.style.fontFamily = currentFont;
  imgElem.setAttribute('src', currentImage);
}</pre> <p>Here, the first three lines grab the values from local storage. Next, we set the values displayed in the form elements to those values, so that they keep in sync when you reload the page. Finally, we update the styles/decorative image on the page, so your customization options come up again on reload.</p> <h2 id="Setting_values_in_storage">Setting values in storage</h2> <p><a title="The setItem() method of the Storage interface, when passed a key name and value, will add that key to the storage, or update that key's value if it already exists." href="../storage/setitem"><code>Storage.setItem()</code></a> is used both to create new data items, and (if the data item already exists) update existing values. This takes two arguments — the key of the data item to create/modify, and the value to store in it.</p> <pre data-language="js">function populateStorage() {
  localStorage.setItem('bgcolor', document.getElementById('bgcolor').value);
  localStorage.setItem('font', document.getElementById('font').value);
  localStorage.setItem('image', document.getElementById('image').value);

  setStyles();
}</pre> <p>The <code>populateStorage()</code> function sets three items in local storage — the background color, font, and image path. It then runs the <code>setStyles()</code> function to update the page styles, etc.</p> <p>We've also included an <code>onchange</code> handler on each form element, so that the data and styling is updated whenever a form value is changed:</p> <pre data-language="js">bgcolorForm.onchange = populateStorage;
fontForm.onchange = populateStorage;
imageForm.onchange = populateStorage;</pre> <h2 id="Responding_to_storage_changes_with_the_StorageEvent">Responding to storage changes with the StorageEvent</h2> <p>The <a title="A StorageEvent is sent to a window when a storage area changes." href="../storageevent"><code>StorageEvent</code></a> is fired whenever a change is made to the <a title="The Storage interface of the Web Storage API provides access to the session storage or local storage for a particular domain, allowing you to for example add, modify or delete stored data items." href="../storage"><code>Storage</code></a> object. This won't work on the same page that is making the changes — it is really a way for other pages on the domain using the storage to sync any changes that are made. Pages on other domains can't access the same storage objects.</p> <p>On the events page (see <a href="https://github.com/mdn/web-storage-demo/blob/gh-pages/event.js">events.js</a>) the only JavaScript is as follows:</p> <pre data-language="js">window.addEventListener('storage', function(e) {  
  document.querySelector('.my-key').textContent = e.key;
  document.querySelector('.my-old').textContent = e.oldValue;
  document.querySelector('.my-new').textContent = e.newValue;
  document.querySelector('.my-url').textContent = e.url;
  document.querySelector('.my-storage').textContent = e.storageArea;
});</pre> <p>Here we add an event listener to the <code>window</code> object that fires when the <a title="The Storage interface of the Web Storage API provides access to the session storage or local storage for a particular domain, allowing you to for example add, modify or delete stored data items." href="../storage"><code>Storage</code></a> object associated with the current origin is changed. As you can see above, the event object associated with this event has a number of properties containing useful information — the key of the data that changed, the old value before the change, the new value after that change, the URL of the document that changed the storage, and the storage object itself.</p> <h2 id="Deleting_data_records">Deleting data records</h2> <p>Web Storage also provides a couple of simple methods to remove data. We don't use these in our demo, but they are very simple to add to your project:</p> <ul> <li>
<a title="The removeItem() method of the Storage interface, when passed a key name, will remove that key from the storage." href="../storage/removeitem"><code>Storage.removeItem()</code></a> takes a single argument — the key of the data item you want to remove — and removes it from the storage object for that domain.</li> <li>
<a title="The clear() method of the Storage interface, when invoked, will empty all keys out of the storage." href="../storage/clear"><code>Storage.clear()</code></a> takes no arguments, and simply empties the entire storage object for that domain.</li> </ul> <h2 id="Specifications">Specifications</h2> <table class="standard-table"> <tbody> <tr> <th scope="col">Specification</th> <th scope="col">Status</th> <th scope="col">Comment</th> </tr> <tr> <td><a hreflang="en" title="The 'Web Storage (Second edition)' specification" class="external" lang="en" href="https://html.spec.whatwg.org/multipage/webstorage.html">Web Storage (Second edition)</a></td> <td><span class="spec-REC">Recommendation</span></td> <td> </td> </tr> </tbody> </table> <h2 id="Browser_compatibility">Browser compatibility</h2>  <div id="compat-desktop"> <table class="compat-table"> <tbody> <tr> <th>Feature</th> <th>Chrome</th> <th>Firefox (Gecko)</th> <th>Internet Explorer</th> <th>Opera</th> <th>Safari (WebKit)</th> </tr> <tr> <td>localStorage</td> <td>4</td> <td>3.5</td> <td>8</td> <td>10.50</td> <td>4</td> </tr> <tr> <td>sessionStorage</td> <td>5</td> <td>2</td> <td>8</td> <td>10.50</td> <td>4</td> </tr> </tbody> </table> </div> <div id="compat-mobile"> <table class="compat-table"> <tbody> <tr> <th>Feature</th> <th>Android</th> <th>Firefox Mobile (Gecko)</th> <th>IE Phone</th> <th>Opera Mobile</th> <th>Safari Mobile</th> </tr> <tr> <td>Basic support</td> <td>2.1</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td>8</td> <td>11</td> <td>iOS 3.2</td> </tr> </tbody> </table> </div> <p>All browsers have varying capacity levels for both localStorage and sessionStorage. Here is a <a title="http://dev-test.nemikor.com/web-storage/support-test/" class="external" href="http://dev-test.nemikor.com/web-storage/support-test/">detailed rundown of all the storage capacities for various browsers</a>.</p> <div class="note"> <p><strong>Note: </strong>since iOS 5.1, Safari Mobile stores localStorage data in the cache folder, which is subject to occasional clean up, at the behest of the OS, typically if space is short.</p> </div> <h2 id="See_also">See also</h2> <ul> <li><a href="../web_storage_api">Web Storage API landing page</a></li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API$edit" class="_attribution-link">Edit this page on MDN</a>
  </p>
</div>
<div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2017 Mozilla Developer Network and individual contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API</a>
  </p>
</div>
