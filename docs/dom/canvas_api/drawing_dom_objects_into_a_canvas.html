<h1>Canvas API: Drawing DOM objects into a canvas</h1> <div class="note"> <p><strong>Before you start</strong></p> <p>To understand this article, it is recommended to be comfortable with <a href="https://developer.mozilla.org/en-US/docs/Glossary/JavaScript" class="glossaryLink" title="JavaScript: JavaScript (JS) is a programming language mostly used client-side to dynamically script webpages, but often also server-side.">JavaScript</a>, the <a href="https://developer.mozilla.org/en-US/docs/Glossary/Canvas" class="glossaryLink" title="The definition of that term (Canvas) has not been written yet; please consider contributing it!">Canvas</a> <a href="https://developer.mozilla.org/en-US/docs/Glossary/API" class="glossaryLink" title="API: An API (Application Programming Interface) is a set of features and rules that exist inside a software program enabling interaction between the software and other items, such as other software or hardware.">API</a> and the <a href="https://developer.mozilla.org/en-US/docs/Glossary/DOM" class="glossaryLink" title="DOM: The DOM (Document Object Model) is an API that represents and interacts with any HTML or XML document. The DOM is a document model loaded in the browser and representing the document as a node tree, where each node represents part of the document (e.g. an element, text string, or comment).">DOM</a> <a href="https://developer.mozilla.org/en-US/docs/Glossary/API" class="glossaryLink" title="API: An API (Application Programming Interface) is a set of features and rules that exist inside a software program enabling interaction between the software and other items, such as other software or hardware.">API</a></p> <p>It's even better if you are also familiar with <a href="https://developer.mozilla.org/en-US/docs/Glossary/SVG" class="glossaryLink" title="SVG: Scalable Vector Graphics (SVG) is a 2D vector image format based on an XML syntax.">SVG</a>. </p> </div> <p>Although it's not trivial (for security reasons), it's possible to draw <a href="https://developer.mozilla.org/en-US/docs/Glossary/DOM" class="glossaryLink" title="DOM: The DOM (Document Object Model) is an API that represents and interacts with any HTML or XML document. The DOM is a document model loaded in the browser and representing the document as a node tree, where each node represents part of the document (e.g. an element, text string, or comment).">DOM</a> content—such as <a href="https://developer.mozilla.org/en-US/docs/Glossary/HTML" class="glossaryLink" title="HTML: HTML (HyperText Markup Language) is a descriptive language that specifies webpage structure.">HTML</a>—into a <a href="https://developer.mozilla.org/en-US/docs/Glossary/canvas" class="glossaryLink" title="The definition of that term (canvas) has not been written yet; please consider contributing it!">canvas</a>. This article, derived from <a href="http://robert.ocallahan.org/2011/11/drawing-dom-content-to-canvas.html" title="http://robert.ocallahan.org/2011/11/drawing-dom-content-to-canvas.html">this blog post</a> by Robert O'Callahan, covers how you can do it securely, safely, and in accordance with the specification.</p> <h2 id="An_overview">An overview</h2> <p>You can't just draw HTML into a canvas. Instead, you need to use an <a href="https://developer.mozilla.org/en-US/docs/Glossary/SVG" class="glossaryLink" title="SVG: Scalable Vector Graphics (SVG) is a 2D vector image format based on an XML syntax.">SVG</a> image containing the content you want to render. To draw HTML content, you'd use a <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/foreignObject" title="The &lt;foreignObject&gt; SVG element allows for inclusion of a foreign XML namespace which has its graphical content drawn by a different user agent. The included foreign graphical content is subject to SVG transformations and compositing."><code>&lt;foreignObject&gt;</code></a> element containing the HTML, then draw that SVG image into your canvas.</p> <h2 id="Step-by-step">Step-by-step</h2> <p>The only really tricky thing here—and that's probably an overstatement—is creating the SVG for your image. All you need to do is create a string containing the <a href="https://developer.mozilla.org/en-US/docs/Glossary/XML" class="glossaryLink" title="XML: eXtensible Markup Language (XML) is a generic markup language specified by the W3C. The information technology (IT) industry uses many languages based on XML as data-description languages.">XML</a> for the SVG and construct a <a href="../blob" title="A Blob object represents a file-like object of immutable, raw data. Blobs represent data that isn't necessarily in a JavaScript-native format. The File interface is based on Blob, inheriting blob functionality and expanding it to support files on the user's system."><code>Blob</code></a> with the following parts.</p> <ol> <li>The MIME media type of the blob should be "image/svg+xml".</li> <li>The <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/svg" title="The svg element can be used to embed an SVG fragment inside the current document (for example, an HTML document). This SVG fragment has its own viewport and coordinate system."><code>&lt;svg&gt;</code></a> element.</li> <li>Inside that, the <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/foreignObject" title="The &lt;foreignObject&gt; SVG element allows for inclusion of a foreign XML namespace which has its graphical content drawn by a different user agent. The included foreign graphical content is subject to SVG transformations and compositing."><code>&lt;foreignObject&gt;</code></a> element.</li> <li>The (well-formed) HTML itself, nested inside the <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/foreignObject" title="The &lt;foreignObject&gt; SVG element allows for inclusion of a foreign XML namespace which has its graphical content drawn by a different user agent. The included foreign graphical content is subject to SVG transformations and compositing."><code>&lt;foreignObject&gt;</code></a>.</li> </ol> <p>By using an object <a href="https://developer.mozilla.org/en-US/docs/Glossary/URL" class="glossaryLink" title="URL: Uniform Resource Locator (URL) is a text string specifying where a resource can be found on the Internet.">URL</a> as described above, we can inline our HTML instead of having to load it from an external source. You can, of course, use an external source if you prefer, as long as the origin is the same as the originating document.</p> <h2 id="Example">Example</h2> <h3 id="HTML">HTML</h3> <pre data-language="html">&lt;canvas id="canvas" style="border:2px solid black;" width="200" height="200"&gt;
&lt;/canvas&gt;
</pre> <h3 id="JavaScript">JavaScript</h3> <pre data-language="js">var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');

var data = '&lt;svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"&gt;' +
           '&lt;foreignObject width="100%" height="100%"&gt;' +
           '&lt;div xmlns="http://www.w3.org/1999/xhtml" style="font-size:40px"&gt;' +
             '&lt;em&gt;I&lt;/em&gt; like ' + 
             '&lt;span style="color:white; text-shadow:0 0 2px blue;"&gt;' +
             'cheese&lt;/span&gt;' +
           '&lt;/div&gt;' +
           '&lt;/foreignObject&gt;' +
           '&lt;/svg&gt;';

var DOMURL = window.URL || window.webkitURL || window;

var img = new Image();
var svg = new Blob([data], {type: 'image/svg+xml'});
var url = DOMURL.createObjectURL(svg);

img.onload = function() {
  ctx.drawImage(img, 0, 0);
  DOMURL.revokeObjectURL(url);
}

img.src = url;</pre> <p>The example above will produce the following</p> <table class="sample-code-table">
<thead><tr>
<th scope="col">Screenshot</th>
<th scope="col">Live sample</th>
</tr></thead>
<tbody><tr>
<td><img src="https://mdn.mozillademos.org/files/3616/example.png" alt="" class="internal"></td>
<td><iframe class="live-sample-frame sample-code-frame" height="210" src="https://mdn.mozillademos.org/en-US/docs/Web/API/Canvas_API/Drawing_DOM_objects_into_a_canvas%24samples/Example?revision=1186815" frameborder="0" width="210" id="frame_Example"></iframe></td>
</tr></tbody>
</table> <p>The <code>data</code> variable is set up with the content of the <a href="https://developer.mozilla.org/en-US/docs/Glossary/SVG" class="glossaryLink" title="SVG: Scalable Vector Graphics (SVG) is a 2D vector image format based on an XML syntax.">SVG</a> image (which in turn includes the <a href="https://developer.mozilla.org/en-US/docs/Glossary/HTML" class="glossaryLink" title="HTML: HTML (HyperText Markup Language) is a descriptive language that specifies webpage structure.">HTML</a>) we want to draw into our <a href="https://developer.mozilla.org/en-US/docs/Glossary/canvas" class="glossaryLink" title="The definition of that term (canvas) has not been written yet; please consider contributing it!">canvas</a>.</p> <p>Then we create a new HTML <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img" title="The HTML &lt;img&gt; element represents an image in the document."><code>&lt;img&gt;</code></a> element by calling <code>new Image()</code>, append <code>data</code>, allocate an object URL, and draw the image into the context by calling <code>drawImage()</code> on load.</p> <h2 id="Security">Security</h2> <p>You might wonder how this can be secure, in light of concerns about the possibility of reading sensitive data out of the canvas. The answer is this: this solution relies on the fact that the implementation of SVG images is <a href="https://developer.mozilla.org/en-US/docs/SVG/SVG_as_an_Image#Restrictions" title="SVG/SVG_as_an_Image#Restrictions">very restrictive</a>. SVG images aren't allowed to load any external resources, for example, even ones that appear to be from the same domain. Resources such as raster images (such as JPEG images) or <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe" title="The HTML Inline Frame Element &lt;iframe&gt; represents a nested browsing context, effectively embedding another HTML page into the current page. In HTML 4.01, a document may contain a head and a body or a head and a frameset, but not both a body and a frameset. However, an &lt;iframe&gt; can be used within a normal document body. Each browsing context has its own session history and active document. The browsing context that contains the embedded content is called the parent browsing context. The top-level browsing context (which has no parent) is typically the browser window."><code>&lt;iframe&gt;</code></a>s have to be inlined as <code>data:</code> URIs.</p> <p>In addition, you can't include script in an SVG image, so there's no risk of access to the <a href="https://developer.mozilla.org/en-US/docs/Glossary/DOM" class="glossaryLink" title="DOM: The DOM (Document Object Model) is an API that represents and interacts with any HTML or XML document. The DOM is a document model loaded in the browser and representing the document as a node tree, where each node represents part of the document (e.g. an element, text string, or comment).">DOM</a> from other scripts, and DOM <a href="https://developer.mozilla.org/en-US/docs/Glossary/Element" class="glossaryLink" title="elements: An element is a part of a webpage. In XML and HTML, an element may contain a data item or a chunk of text or an image, or perhaps nothing. A typical element includes an opening tag with some attributes, enclosed text content, and a closing tag:">elements</a> in SVG images can't receive input events, so there's no way to load privileged information into a form control (such as a full path into a file <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input" title="The HTML &lt;input&gt; element is used to create interactive controls for web-based forms in order to accept data from the user. How an &lt;input&gt; works varies considerably depending on the value of its type attribute."><code>&lt;input&gt;</code></a> element) and render it, then pull that information out by reading the pixels.</p> <p>Visited-link styles aren't applied to links rendered in SVG images, so history information can't be retrieved, and native themes aren't rendered in SVG images, which makes it harder to determine the user's platform.</p> <p>The resulting canvas should be origin clean, meaning you can call <code>toBlob(function(blob){…})</code> to return a blob for the canvas, or <code>toDataURL()</code> to return a Base64-encoded <code>data:</code> URI.</p> <h2 id="Drawing_HTML">Drawing HTML</h2> <p>Since <a href="https://developer.mozilla.org/en-US/docs/Glossary/SVG" class="glossaryLink" title="SVG: Scalable Vector Graphics (SVG) is a 2D vector image format based on an XML syntax.">SVG</a> must be valid <a href="https://developer.mozilla.org/en-US/docs/Glossary/XML" class="glossaryLink" title="XML: eXtensible Markup Language (XML) is a generic markup language specified by the W3C. The information technology (IT) industry uses many languages based on XML as data-description languages.">XML</a>, you need to parse <a href="https://developer.mozilla.org/en-US/docs/Glossary/HTML" class="glossaryLink" title="HTML: HTML (HyperText Markup Language) is a descriptive language that specifies webpage structure.">HTML</a> to get the well-formed output of the HTML parser. The following code is the easiest way to parse HTML.</p> <pre data-language="js">var doc = document.implementation.createHTMLDocument('');
doc.write(html);

// You must manually set the xmlns if you intend to immediately serialize 
// the HTML document to a string as opposed to appending it to a 
// &lt;foreignObject&gt; in the DOM
doc.documentElement.setAttribute('xmlns', doc.documentElement.namespaceURI);

// Get well-formed markup
html = (new XMLSerializer).serializeToString(doc);</pre> <h2 id="See_also">See also</h2> <ul> <li><a href="../canvas_api" title="HTML/Canvas">Canvas</a></li> <li><a href="tutorial" title="Canvas tutorial">Canvas tutorial</a></li> <li>
<a href="http://robert.ocallahan.org/2011/11/drawing-dom-content-to-canvas.html" title="http://robert.ocallahan.org/2011/11/drawing-dom-content-to-canvas.html">Drawing DOM content to canvas</a> (blog post)</li> <li>
<a href="http://cburgmer.github.com/rasterizeHTML.js/" title="http://cburgmer.github.com/rasterizeHTML.js/">rasterizeHTML.js</a>, an implementation following this post</li> <li>
<a href="http://fred-wang.github.io/TeXZilla/examples/toImageWebGL.html">Drawing math equations into a canvas</a>, using TeXZilla.</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Drawing_DOM_objects_into_a_canvas$edit" class="_attribution-link">Edit this page on MDN</a>
  </p>
</div>
<div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2017 Mozilla Developer Network and individual contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Drawing_DOM_objects_into_a_canvas" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Drawing_DOM_objects_into_a_canvas</a>
  </p>
</div>
