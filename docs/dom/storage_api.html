<h1>Storage API</h1><div class="overheadIndicator draft"> <p><strong>Draft</strong><br> This page is not complete.</p> </div> <p>The Storage Standard defines a common, shared storage system to be used by all APIs and technologies that store content-accessible data for individual Web sites. The Storage API gives sites' code the ability to find out how much space they can use, how much they are already using, and even control whether or not they need to be alerted before the <a href="https://developer.mozilla.org/en-US/docs/Glossary/user_agent" class="glossaryLink" title="user agent: A user agent is a computer program representing a person, for example, a browser in a Web context.">user agent</a> disposes of site data in order to make room for other things.</p> <div class="note">
<strong>Note:</strong> This feature is available in <a href="web_workers_api">Web Workers</a>.</div> <p>Site storage—the data stored for a Web site which is managed by the Storage Standard—includes:</p> <ul> <li><a href="indexeddb_api">IndexedDB databases</a></li> <li><a href="cache">Cache API data</a></li> <li><a href="service_worker_api">Service Worker registrations</a></li> <li>
<a href="web_storage_api">Web Storage API data</a> managed using <a href="window/localstorage" title="The localStorage property allows you to access a local Storage object. localStorage is similar to sessionStorage. The only difference is that, while data stored in localStorage has no expiration time, data stored in sessionStorage gets cleared when the browsing session ends—that is, when the browser is closed."><code>window.localStorage</code></a> and <a href="window/sessionstorage" title="The sessionStorage property allows you to access a session Storage object for the current origin. sessionStorage is similar to Window.localStorage, the only difference is while data stored in localStorage has no expiration set, data stored in sessionStorage gets cleared when the page session ends. A page session lasts for as long as the browser is open and survives over page reloads and restores. Opening a page in a new tab or window will cause a new session to be initiated, which differs from how session cookies work."><code>window.sessionStorage</code></a>
</li> <li>History state information saved using <a href="history_api" title="The DOM window object provides access to the browser's history through the history object. It exposes useful methods and properties that let you move back and forth through the user's history, as well as -- starting with HTML5 -- manipulate the contents of the history stack."><code>History.pushState()</code></a>
</li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Using_the_application_cache">Application caches</a></li> <li><a href="notifications_api">Notification data</a></li> <li>Other kinds of site-accessible, site-specific data that may be maintained</li> </ul> <h2 id="Site_storage_units">Site storage units</h2> <p>The site storage system described by the Storage Standard and interacted with using the Storage API consists of a single <strong>site storage unit</strong> for each <a href="https://developer.mozilla.org/en-US/docs/Glossary/origin" class="glossaryLink" title="origin: Web content's origin is defined by the scheme (protocol), host (domain), and port of the URL used to access it. Two objects have the same origin only when the scheme, host, and port all match.">origin</a>. In essence, every Web site or Web application has its own storage unit into which its data gets placed. The diagram below shows a site storage pool with three storage units within, showing how storage units can have different data types stored within and may have different quotas (maximum storage limits).</p> <p><img src="https://mdn.mozillademos.org/files/14379/StorageUnits.png" style="height: 412px; width: 600px;" alt="A diagram showing how the site storage pool consists of multiple storage units that contain data from various APIs as well as possible unused space left before the quota is reached."></p> <ul> <li>Origin 1 has some Web Storage data as well as some IndexedDB data, but also has some free space left; its current usage hasn't yet reached its quota.</li> <li>Origin 2 has no data stored in it yet; it's just an empty box waiting for content. This origin, however, has a lower quota than the other two do. It may be a less-visited site, or one known to have lower data storage requirements.</li> <li>Origin 3's storage unit is completely full; it's reached its quota and can't store any more data without some existing material being removed.</li> </ul> <p><a href="https://developer.mozilla.org/en-US/docs/Glossary/User_agent" class="glossaryLink" title="User agents: A user agent is a computer program representing a person, for example, a browser in a Web context.">User agents</a> are likely to use various techniques to determine the quota for various origins. One of the most likely methods—one which the specification specifically encourages, in fact—would be to consider the popularity and/or usage levels of individual sites to determine what their quotas should be. It's also conceivable that the browser might offer a user interface to customize these quotas.</p> <h2 id="Box_modes">Box modes</h2> <p>The actual data storage within each site storage unit is called its <strong>box</strong>. Each site storage unit has exactly one box into which all of its data is placed, and has a <strong>box mode</strong> that describes the data retention policy for that box. There are two modes:</p> <dl> <dt><code>"best-effort"</code></dt> <dd>The user agent will try to retain the data contained in the box for as long as it can, <em>but will not warn users</em> if storage space runs low and it becomes necessary to clear the box in order to relieve the storage pressure.</dd> <dt><code>"persistent"</code></dt> <dd>The user agent will retain the data as long as possible, clearing all <code>"best-effort"</code> boxes before considering clearing a box marked <code>"persistent"</code>. If it becomes necessary to consider clearing persistent boxes, the user agent will notify the user and provide a way to clear one or more persistent boxes as needed.</dd> </dl> <p>To change an origin's box mode requires permission to use the <code>"persistent-storage"</code> feature.</p> <h2 id="Data_persistence_and_clearing">Data persistence and clearing</h2> <p>If the site or app has the <strong><code>"persistent-storage"</code></strong> feature permission, it can use the <a href="storagemanager/persist" title="The persist property of the StorageManager interface returns a Promise that resolves to true if the user agent is able to persist your site's storage."><code>StorageManager.persist()</code></a> method to request that its box be made persistent. It's also possible for the user agent to decide to make the site's storage unit persistent due to usage characteristics or other metrics. The <code>"persistent-storage"</code> feature's permission-related flags, algorithms, and types are all set to the standard defaults for a permission, except that the <strong>permission state</strong> must be the same across the entire origin, and that if the permission state isn't <code>"granted"</code> (meaning that for whatever reason, access to the persistent storage feature was denied), the origin's site storage unit's box mode is always <code>"best-effort"</code>.</p> <div class="note"> <p>See <a href="https://developer.mozilla.org/en-US/docs/Web/API/Permissions_API/Using_the_Permissions_API">Using the Permissions API</a> for further details about obtaining and managing permissions.</p> </div> <p>When clearing site storage units, an origin's box is treated as a single entity; if the user agent needs to clear it and the user approves, the entire data store is cleared rather than providing some means of clearing only data from individual APIs.</p> <p><strong><em>example tbd</em></strong></p> <p>If a box is marked as <code>"persistent"</code>, the contents won't be cleared by the user agent without either the data's origin itself or the user specifically doing so. This includes scenarios such as the user selecting a "Clear Caches" or "Clear Recent History" option. The user will be asked specifically for permission to remove persistent site storage units.</p> <h2 id="Quotas_and_usage_estimates">Quotas and usage estimates</h2> <p>The user agent determines, using whatever mechanism it chooses, the maximum amount of storage a given site can use. This maximum is the origin's <strong>quota</strong>. The amount of this space which is in use by the site is called its <strong>usage</strong>. Both of these values are estimates; there are several reasons why they're not precise:</p> <ul> <li>User agents are encouraged to obscure the exact size of the data used by a given origin, to prevent these values from being used for fingerprinting purposes.</li> <li>De-duplication, compression, and other methods to reduce the physical size of the stored data may be used.</li> <li>Quotas are conservative estimates of the space available for the origin's use, and should be less than the available space on the device to help prevent overruns.</li> </ul> <p>User agents may use any method they choose to determine the size of origins' quotas, and are encouraged by the specification to provide popular or frequently-used sites with extra space.</p> <p>To determine the estimated quota and usage values for a given origin, use the <a href="storagemanager/estimate" title="The estimate() method of the StorageManager interface asks the Storage Manager to obtain quota and usage information for the current origin. This method operates asynchronously, so it returns a Promise which resolves once the information is available. The promise's fulfillment handler receives as an input a StorageEstimate with the usage and quota data."><code>navigator.storage.estimate()</code></a> method, which returns a promise that, when resolved, receives a <a href="storageestimate" title="The StorageEstimate dictionary is used by the StorageManager to provide estimates of the size of a Web site's or application's data store and how much of it is in use. The navigator.storage.estimate() method returns an object that conforms to this dictionary when its Promise is resolved."><code>StorageEstimate</code></a> that contains these figures. For example:</p> <pre data-language="js">navigator.storage.estimate().then(estimate =&gt; {
  // estimate.quota is the estimated quota
  // estimate.usage is the estimated number of bytes used
});</pre> <h2 id="Specifications">Specifications</h2> <table class="standard-table"> <tbody> <tr> <th scope="col">Specification</th> <th scope="col">Status</th> <th scope="col">Comment</th> </tr> <tr> <td><a href="https://storage.spec.whatwg.org" class="external" lang="en" title="The 'Storage' specification" hreflang="en">Storage</a></td> <td><span class="spec-Living">Living Standard</span></td> <td>Initial definition.</td> </tr> </tbody> </table> <h2 id="Browser_compatibility">Browser compatibility</h2>  <div id="compat-desktop"> <table class="compat-table"> <tbody> <tr> <th>Feature</th> <th>Chrome</th> <th>Firefox (Gecko)</th> <th>Internet Explorer</th> <th>Opera</th> <th>Safari (WebKit)</th> </tr> <tr> <td>Basic support</td> <td>55.0</td> <td>
<a href="https://developer.mozilla.org/en-US/Firefox/Releases/51" title="Released on 2017-01-24.">51</a> (51)<sup>[1]</sup>
</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td>42</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> </tr> <tr> <td>Persistence support</td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td><span style="color: #f00;">No support</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> </tr> <tr> <td>Estimates support</td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td>
<a href="https://developer.mozilla.org/en-US/Firefox/Releases/51" title="Released on 2017-01-24.">51</a> (51)</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> </tr> </tbody> </table> </div> <div id="compat-mobile"> <table class="compat-table"> <tbody> <tr> <th>Feature</th> <th>Android</th> <th>Android Webview</th> <th>Firefox Mobile (Gecko)</th> <th>Firefox OS</th> <th>IE Mobile</th> <th>Opera Mobile</th> <th>Safari Mobile</th> <th>Chrome for Android</th> </tr> <tr> <td>Basic support</td> <td><span style="color: #f00;">No support</span></td> <td>55.0</td> <td>51.0 (51)<sup>[1]</sup>
</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td>42</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td>55.0</td> </tr> <tr> <td>Persistence support</td> <td><span style="color: #f00;">No support</span></td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td><span style="color: #f00;">No support</span></td> <td><span style="color: #f00;">No support</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> </tr> <tr> <td>Estimates support</td> <td><span style="color: #f00;">No support</span></td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td>51.0 (51)</td> <td><span style="color: #f00;">No support</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> </tr> </tbody> </table> </div> <p>[1] Firefox 51 introduced <a href="navigatorstorage" title="The NavigatorStorage mixin adds to the Navigator and WorkerNavigator interfaces the Navigator.storage property, which provides access to the StorageManager singleton used for controlling the persistence of data stores as well as obtaining information"><code>NavigatorStorage</code></a>, <a href="navigatorstorage/storage" title="The NavigatorStorage.storage read-only property returns the singleton StorageManager object used to access the overall storage capabilities of the browser for the current site or app. The returned object lets you examine and configure persistence of data stores and learn approximately how much more space your browser has available for local storage use."><code>navigator.storage</code></a>, and the <a href="storagemanager/estimate" title="The estimate() method of the StorageManager interface asks the Storage Manager to obtain quota and usage information for the current origin. This method operates asynchronously, so it returns a Promise which resolves once the information is available. The promise's fulfillment handler receives as an input a StorageEstimate with the usage and quota data."><code>StorageManager.estimate()</code></a> method, as well as <a href="storageestimate" title="The StorageEstimate dictionary is used by the StorageManager to provide estimates of the size of a Web site's or application's data store and how much of it is in use. The navigator.storage.estimate() method returns an object that conforms to this dictionary when its Promise is resolved."><code>StorageEstimate</code></a>. These are enabled by default in <a href="http://nightly.mozilla.org/">nightly builds</a> but disabled by default in all other builds. You can enable these features by setting the preference <code>dom.storageManager.enabled</code> to <code>true</code>.</p> <h2 id="See_also">See also</h2> <ul> <li><a href="navigatorstorage/storage" title="The NavigatorStorage.storage read-only property returns the singleton StorageManager object used to access the overall storage capabilities of the browser for the current site or app. The returned object lets you examine and configure persistence of data stores and learn approximately how much more space your browser has available for local storage use."><code>navigator.storage</code></a></li> <li>
<a href="storagemanager" title="The StorageManger interface of the the Storage API provides an interface for managing persistance permissions and estimating available storage. You can get a reference to this interface using either navigator.storage or WorkerNavigator.storage."><code>StorageManager</code></a> (the object returned by <code>navigator.storage</code>)</li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Permissions_API/Using_the_Permissions_API">Using the Permissions API</a></li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Storage_API$edit" class="_attribution-link">Edit this page on MDN</a>
  </p>
</div>
<div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2017 Mozilla Developer Network and individual contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Storage_API" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/Storage_API</a>
  </p>
</div>
