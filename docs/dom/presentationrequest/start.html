<h1>PresentationRequest.start</h1><p>When the <code><dfn>start</dfn></code> method is called, the <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-user-agents">user agent</a> <em>MUST</em> run the following steps to <dfn>start a presentation</dfn>:</p> <dl> <dt>Input</dt> <dd>
<var>presentationRequest</var>, the <code>PresentationRequest</code> object</dd> <dd>
<var>presentationUrls</var>, the <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-request-urls">presentation request URLs</a>
</dd> <dt>Output</dt> <dd>A <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-promise">Promise</a>
</dd> </dl> <ol> <li>If the algorithm isn't <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-allowed-to-show-a-popup">allowed to show a popup</a>, return a <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-promise">Promise</a> rejected with an <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-invalidaccesserror"><code>InvalidAccessError</code></a> exception and abort these steps.</li> <li>Using the document's <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-settings-object">settings object</a>, run the <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-prohibits-mixed-security-contexts-algorithm">prohibits mixed security contexts algorithm</a>.</li> <li>If the result of the algorithm is <code>"Prohibits Mixed Security Contexts"</code> and <var>presentationUrl</var> is an <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-a-priori-unauthenticated-url"> a priori unauthenticated URL</a>, then return a <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-promise">Promise</a> rejected with a <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-securityerror"><code>SecurityError</code></a> and abort these steps.</li> <li>If the document object's <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-active-sandboxing-flag-set">active sandboxing flag set</a> has the <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#sandboxed-presentation-browsing-context-flag">sandboxed presentation browsing context flag</a> set, then return a <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-promise">Promise</a> rejected with a <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-securityerror"><code>SecurityError</code></a> and abort these steps.</li> <li>If there is already an unsettled <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-promise">Promise</a> from a previous call to <code>start</code> for the same <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-controlling-browsing-context">controlling browsing context</a>, return a <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-promise">Promise</a> rejected with an <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-operationerror"><code>OperationError</code></a> exception and abort all remaining steps.</li> <li>Let <var>P</var> be a new <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-promise">Promise</a>.</li> <li>Return <var>P</var>, but continue running these steps in parallel.</li> <li>If the <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-user-agents">user agent</a> is not <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-monitor-the-list-of-available-presentation-displays">monitoring the list of available presentation displays</a>, run the steps to <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-monitor-the-list-of-available-presentation-displays">monitor the list of available presentation displays</a> <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-in-parallel">in parallel</a>.</li> <li>Request user permission for the use of a <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-display">presentation display</a> and selection of one presentation display.</li> <li>If either of the following is true: <ol> <li>The <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-list-of-available-presentation-displays">list of available presentation displays</a> is empty and will remain so before the request for user permission is completed.</li> <li>No member in the <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-list-of-available-presentation-displays">list of available presentation displays</a> is a <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-compatible-presentation-display">compatible presentation display</a> for any member of <var>presentationUrls</var>.</li> </ol> Then run the following steps: <ol> <li>
<a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-rejecting-a-promise">Reject</a> <var>P</var> with a <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-notfounderror"><code>NotFoundError</code></a> exception.</li> <li>Abort all remaining steps.</li> </ol> </li> <li>If the user <em>denied permission</em> to use a display, reject <var>P</var> with an <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-notallowederror"><code>NotAllowedError</code></a> exception, and abort all remaining steps.</li> <li>Otherwise, the user <em>granted permission</em> to use a display; let <var>D</var> be that display and <var>U</var> the user agent connected to <var>D</var>.</li> <li>Let <var>I</var> be a new <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-valid-presentation-identifier">valid presentation identifier</a> unique among all <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier">presentation identifiers</a> for known <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-connection">presentation connections</a> in the <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-set-of-controlled-presentations">set of controlled presentations</a>. To avoid fingerprinting, it is recommended that the <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier">presentation identifier</a> be set to a <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-uuid">UUID</a> generated following forms 4.4 or 4.5 of [<cite><a class="bibref external external-icon" href="https://www.w3.org/TR/presentation-api/#bib-rfc4122">rfc4122</a></cite>].</li> <li>Create a new <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#idl-def-presentationconnection"><code>PresentationConnection</code></a> <var>S</var>.</li> <li>Set the <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier">presentation identifier</a> of <var>S</var> to <var> I</var>.</li> <li>Set the <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-url">presentation URL</a> for <var>S</var> to the first <var>presentationUrl</var> in <var>presentationUrls</var> for which there exists an entry <var>(presentationUrl, D)</var> in the <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-list-of-available-presentation-displays">list of available presentation displays</a>.</li> <li>Set the <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-connection-state">presentation connection state</a> of <var>S</var> to <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dom-presentationconnectionstate-connecting"><code>connecting</code></a>.</li> <li>Add <var>S</var> to the <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-set-of-controlled-presentations">set of controlled presentations</a>.</li> <li>
<a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-resolving-a-promise">Resolve</a> <var>P</var> with <var>S</var>.</li> <li>
<a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-queue-a-task">Queue a task</a> to <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-firing-an-event">fire</a> a <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-trusted-event">trusted event</a> with the name <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-connectionavailable"><code>connectionavailable</code></a>, that uses the <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#idl-def-presentationconnectionavailableevent"><code>PresentationConnectionAvailableEvent</code></a> interface, with the <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#idl-def-presentationconnectionavailableevent-connection"><code>connection</code></a> attribute initialized to <var>S</var>, at <var>presentationRequest</var>. The event must not bubble, must not be cancelable, and has no default action.</li> <li>If any of the following steps fails, abort all remaining steps and <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-close-a-presentation-connection">close the presentation connection</a> <var>S</var> with <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dom-presentationconnectionclosedreason-error"><code>error</code></a> as <var>closeReason</var>, and a human readable message describing the failure as <var>closeMessage</var>.</li> <li>Using an implementation specific mechanism, tell <var>U</var> to <a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-create-a-receiving-browsing-context">create a receiving browsing context</a> with <var>D</var>, <var>presentationUrl</var>, and <var>I</var> as parameters.</li> <li>
<a class="external internalDFN external-icon" href="https://www.w3.org/TR/presentation-api/#dfn-establish-a-presentation-connection">Establish a presentation connection</a> with <var>S</var>.</li> </ol> <div class="note"> <p><strong>Note:</strong> The details of implementing the permission request and display selection are left to the user agent; for example it may show the user a dialog and allow the user to select an available display (granting permission), or cancel the selection (denying permission). Implementers are encouraged to show the user whether an available display is currently in use, to facilitate presentations that can make use of multiple displays.</p> </div> <div class="note"> <p><strong>Note:</strong> The <var>presentationUrl</var> should name a resource accessible to the local or a remote user agent. This specification defines behavior for <var>presentationUrl</var> using the <code>http</code> or <code>https</code> schemes; behavior for other schemes is not defined by this specification.</p> </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/PresentationRequest/start$edit" class="_attribution-link">Edit this page on MDN</a>
  </p>
</div>
<div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2017 Mozilla Developer Network and individual contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/PresentationRequest/start" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/PresentationRequest/start</a>
  </p>
</div>
