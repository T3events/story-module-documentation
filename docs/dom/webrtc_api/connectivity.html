<h1>WebRTC API: Connectivity</h1><div class="overheadIndicator draft"> <p><strong>Draft</strong><br> This page is not complete.</p> </div> <p>Now that we've covered the protocols individually, we can put them together. <span class="seoSummary">This article describes how the various WebRTC-related protocols interact with one another in order to create a connection and transfer data and/or media among peers.</span></p> <div class="note"> <p>This page needs heavy rewriting for structural integrity and content completeness. Lots of info here is good but the organization is a mess since this is sort of a dumping ground right now.</p> </div> <h2 id="What_is_an_OfferAnswer_and_Signal_Channel">What is an Offer/Answer and Signal Channel?</h2> <p>Unfortunately WebRTC can’t create connections without some sort of server in the middle. We call this the Signal Channel. It’s any sort of channel of communication to exchange information before setting up a connection, whether by email, post card or a carrier pigeon... it’s up to you.</p> <p>The information we need to exchange is the Offer and Answer which just contains the SDP mentioned below.</p> <p>Peer A who will be the initiator of the connection, will create an Offer. They will then send this offer to Peer B using the chosen signal channel. Peer B will receive the Offer from the signal channel and create an Answer. They will then send this back to Peer A along the signal channel.</p> <h3 id="Session_descriptions">Session descriptions</h3> <p>The configuration of an endpoint on a WebRTC connection is called a <strong>session description</strong>. The description includes information about the kind of media being sent, its format, the transfer protocol being used, the endpoint's IP address and port, and other information needed to describe a media transfer endpoint. This information is exchanged and stored using <strong>Session Description Protocol</strong> (<a title="SDP: SDP (Session Description Protocol) is the standard describing a peer-to-peer connection. SDP contains the codec, source address, and timing information of audio and video." href="https://developer.mozilla.org/en-US/docs/Glossary/SDP" class="glossaryLink">SDP</a>); if you want details on the format of SDP data, you can find it in <a href="http://tools.ietf.org/html/2327">RFC 2327</a>.</p> <p>When a user starts a WebRTC call to another user, a special description is created called an <strong>offer</strong>. This description includes all the information about the caller's proposed configuration for the call. The recipient then responds with an <strong>answer</strong>, which is a description of their end of the call. In this way, both devices share with one another the information needed in order to exchange media data. This exchange is handled using Interactive Connectivity Establishment (<a title="ICE: ICE (Interactive Connectivity Establishment) is a framework used by WebRTC (among other technologies) for connecting two peers to each other, regardless of network topology (usually for audio and/or video chat). This protocol lets two peers find and establish a connection with one another even though they may both be using Network Address Translator (NAT) to share a global IP address with other devices on their respective local networks." href="https://developer.mozilla.org/en-US/docs/Glossary/ICE" class="glossaryLink">ICE</a>, a protocol which lets two devices use an intermediary to exchange offers and answers even if the two devices are separated by Network Address Translation (<a title="NAT: NAT (Network Address Translation) is a technique for letting multiple computers share an IP address. NAT assigns unique addresses to each computer on the local network and adjusts incoming/outgoing network traffic to send data to the right place." href="https://developer.mozilla.org/en-US/docs/Glossary/NAT" class="glossaryLink">NAT</a>).</p> <p>Each peer, then, keeps two descriptions on hand: the <strong>local description</strong>, describing itself, and the <strong>remote description</strong>, describing the other end of the call.</p> <p>The offer/answer process is performed both when a call is first established, but also any time the call's format or other configuration needs to change. Regardless of whether it's a new call, or reconfiguring an existing one, these are the basic steps which must occur to exchange the offer and answer, leaving out the ICE layer for the moment:</p> <ol> <li>The caller calls <a title="The createOffer() method of the RTCPeerConnection interface initiates the creation of an SDP offer which includes information about any MediaStreamTracks already attached to the WebRTC session, codec and options supported by the browser, and any candidates already gathered by the ICE agent, for the purpose of being sent over the signaling channel to a potential peer to request a connection or to update the configuration of an existing connection." href="../rtcpeerconnection/createoffer"><code>RTCPeerConnection.createOffer()</code></a> to create an offer.</li> <li>The caller calls <a title="The RTCPeerConnection.setLocalDescription() method changes the local description associated with the connection. This description specifies the properties of the local end of the connection, including the media format. The actual connection is affected by this change, so it must be able to support both the old and new descriptions in order for the change to actually take place. The method takes a single parameter—the session description—and it returns a Promise which is fulfilled once the description has been changed, asynchronously." href="../rtcpeerconnection/setlocaldescription"><code>RTCPeerConnection.setLocalDescription()</code></a> to set that offer as the <em>local description</em> (that is, the description of the local end of the connection).</li> <li>The caller uses the signaling server to transmit the offer to the intended receiver of the call.</li> <li>The recipient receives the offer and calls <a title="The RTCPeerConnection.setRemoteDescription() method changes the remote description associated with the connection. This description specifies the properties of the remote end of the connection, including the media format. The actual connection is affected by this change, so it must be able to support both the old and new descriptions in order for the change to actually take place. The method takes a single parameter—the session description—and it returns a Promise which is fulfilled once the description has been changed, asynchronously." href="../rtcpeerconnection/setremotedescription"><code>RTCPeerConnection.setRemoteDescription()</code></a> to record it as the <em>remote description</em> (the description of the other end of the connection).</li> <li>The recipient does any setup it needs to do for its end of the call, including adding outgoing streams to the connection.</li> <li>The recipient then creates an answer by calling <a title="The createAnswer() method on the RTCPeerConnection interface creates an answer to an offer received from a remote peer during the offer/answer negotiation of a WebRTC connection. Once the answer is created, it should be sent to the source of the offer to continue the negotiation process." href="../rtcpeerconnection/createanswer"><code>RTCPeerConnection.createAnswer()</code></a>.</li> <li>The recipient calls <a title="The RTCPeerConnection.setLocalDescription() method changes the local description associated with the connection. This description specifies the properties of the local end of the connection, including the media format. The actual connection is affected by this change, so it must be able to support both the old and new descriptions in order for the change to actually take place. The method takes a single parameter—the session description—and it returns a Promise which is fulfilled once the description has been changed, asynchronously." href="../rtcpeerconnection/setlocaldescription"><code>RTCPeerConnection.setLocalDescription()</code></a> to set the answer as its local description. The recipient now knows the configuration of both ends of the connection.</li> <li>The recipient uses the signaling server to send the answer to the caller.</li> <li>The caller receives the answer.</li> <li>The caller calls <a title="The RTCPeerConnection.setRemoteDescription() method changes the remote description associated with the connection. This description specifies the properties of the remote end of the connection, including the media format. The actual connection is affected by this change, so it must be able to support both the old and new descriptions in order for the change to actually take place. The method takes a single parameter—the session description—and it returns a Promise which is fulfilled once the description has been changed, asynchronously." href="../rtcpeerconnection/setremotedescription"><code>RTCPeerConnection.setRemoteDescription()</code></a> to set the answer as the remote description for its end of the call. It now knows the configuration of both peers. Media begins to flow as configured.</li> </ol> <h3 id="Pending_and_current_descriptions">Pending and current descriptions</h3> <p>Taking one step deeper into the process, we find that <code>localDescription</code> and <code>remoteDescription</code>, the properties which return these two descriptions, aren't as simple as they look. Because during renegotiation, an offer might be rejected because it proposes an incompatible format, it's necessary that each endpoint have the ability to propose a new format but not actually switch to it until it's accepted by the other peer. For that reason, WebRTC uses <em>pending</em> and <em>current</em> descriptions.</p> <p>The <strong>current description</strong> (which is returned by the <a title="The read-only property RTCPeerConnection.currentLocalDescription returns an RTCSessionDescription object describing the local end of the connection as it was most recently successfully negotiated since the last time the  RTCPeerConnection finished negotiating and connecting to a remote peer. Also included is a list of any ICE candidates that may already have been generated by the ICE agent since the offer or answer represented by the description was first instantiated." href="../rtcpeerconnection/currentlocaldescription"><code>RTCPeerConnection.currentLocalDescription</code></a> and <a title="The read-only property RTCPeerConnection.currentRemoteDescription returns an RTCSessionDescription object describing the remote end of the connection as it was most recently successfully negotiated since the last time the RTCPeerConnection finished negotiating and connecting to a remote peer. Also included is a list of any ICE candidates that may already have been generated by the ICE agent since the offer or answer represented by the description was first instantiated." href="../rtcpeerconnection/currentremotedescription"><code>RTCPeerConnection.currentRemoteDescription</code></a> properties) represents the description currently in actual use by the connection. This is the most recent connection that both sides have fully agreed to use.</p> <p>The <strong>pending description</strong> (returned by <a title='The read-only property RTCPeerConnection.pendingLocalDescription returns an RTCSessionDescription object describing a pending configuration change for the local end of the connection. This does not describe the connection as it currently stands, but as it may exist in the near future. Use RTCPeerConnection.currentLocalDescription or RTCPeerConnection.localDescription to get the current state of the endpoint. For details on the difference, see "Pending and current descriptions" in WebRTC connectivity.' href="../rtcpeerconnection/pendinglocaldescription"><code>RTCPeerConnection.pendingLocalDescription</code></a> and <a title='The read-only property RTCPeerConnection.pendingRemoteDescription returns an RTCSessionDescription object describing a pending configuration change for the remote end of the connection. This does not describe the connection as it currently stands, but as it may exist in the near future. Use RTCPeerConnection.currentRemoteDescription or RTCPeerConnection.remoteDescription to get the current session description for the remote endpoint. For details on the difference, see "Pending and current descriptions" in WebRTC connectivity.' href="../rtcpeerconnection/pendingremotedescription"><code>RTCPeerConnection.pendingRemoteDescription</code></a>) indicates a description which is currently under consideration following a call to <code>setLocalDescription()</code> or <code>setRemoteDescription()</code>, respectively.</p> <p>When reading the description (returned by <a title="The read-only property RTCPeerConnection.localDescription returns an RTCSessionDescription describing the session for the local end of the connection. If it has not yet been set, this is null." href="../rtcpeerconnection/localdescription"><code>RTCPeerConnection.localDescription</code></a> and <a title="The read-only property RTCPeerConnection.remoteDescription returns a RTCSessionDescription describing the session (which includes configuration and media information) for the remote end of the connection. If this hasn't been set yet, this is null." href="../rtcpeerconnection/remotedescription"><code>RTCPeerConnection.remoteDescription</code></a>), the returned value is the value of <code>pendingLocalDescription</code>/<code>pendingRemoteDescription</code> if there's a pending description (that is, the pending description isn't <code>null</code>); otherwise, the current description (<code>currentLocalDescription</code>/<code>currentRemoteDescription</code>) is returned.</p> <p>When changing the description by calling <code>setLocalDescription()</code> or <code>setRemoteDescription()</code>, the specified description is set as the pending description, and the WebRTC layer begins to evaluate whether or not it's acceptable. Once the proposed description has been agreed upon, the value of <code>currentLocalDescription</code> or <code>currentRemoteDescription</code> is changed to the pending description, and the pending description is set to null again, indicating that there isn't a pending description.</p> <div class="note"> <p>The <code>pendingLocalDescription</code> contains not just the offer or answer under consideration, but any local ICE candidates which have already been gathered since the offer or answer was created. Similarly, <code>pendingRemoteDescription</code> includes any remote ICE candidates which have been provided by calls to <a title="When a web site or app using RTCPeerConnection receives a new ICE candidate from the remote peer over its signaling channel, it delivers the newly-received candidate to the browser's ICE agent by calling RTCPeerConnection.addIceCandidate()." href="../rtcpeerconnection/addicecandidate"><code>RTCPeerConnection.addIceCandidate()</code></a>.</p> </div> <p>See the individual articles on these properties and methods for more specifics.</p> <h2 id="What_is_an_ICE_candidate">What is an ICE candidate?</h2> <p>As well as exchanging information about the media (discussed above in Offer/Answer and SDP), peers must exchange information about the network connection. This is known as an ICE candidate and details the available methods the peer is able to communicate (directly or through a TURN server).</p> <h2 id="The_entire_exchange_in_a_complicated_diagram">The entire exchange in a complicated diagram</h2> <p><a href="https://hacks.mozilla.org/wp-content/uploads/2013/07/webrtc-complete-diagram.png"><img src="https://mdn.mozillademos.org/files/6119/webrtc-complete-diagram.png" style="display: block; height: 559px; margin: 0px auto; width: 641px;" alt="A complete architectural diagram showing the whole WebRTC process."></a></p><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Connectivity$edit" class="_attribution-link">Edit this page on MDN</a>
  </p>
</div>
<div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2017 Mozilla Developer Network and individual contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Connectivity" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Connectivity</a>
  </p>
</div>
