<h1>ExtendableEvent</h1><div><div class="notice experimental"> <p> <strong>This is an experimental technology</strong><br>Because this technology's specification has not stabilized, check the <a href="#Browser_compatibility">compatibility table</a> for usage in various browsers. Also note that the syntax and behavior of an experimental technology is subject to change in future versions of browsers as the specification changes.</p> </div></div> <p>The <strong><code>ExtendableEvent</code></strong> interface extends the lifetime of the <code><a href="https://developer.mozilla.org/en-US/docs/Web/Events/install" title="/en-US/docs/Web/Events/install">install</a></code> and <code><a href="https://developer.mozilla.org/en-US/docs/Web/Events/activate" title="/en-US/docs/Web/Events/activate">activate</a></code> events dispatched on the global scope as part of the service worker lifecycle. This ensures that any functional events (like <a href="fetchevent" title="The parameter passed into the ServiceWorkerGlobalScope.onfetch handler, FetchEvent represents a fetch action that is dispatched on the ServiceWorkerGlobalScope of a ServiceWorker. It contains information about the request and resulting response, and provides the FetchEvent.respondWith() method, which allows us to provide an arbitrary response back to the controlled page."><code>FetchEvent</code></a>) are not dispatched until it upgrades database schemas and deletes the outdated cache entries.</p> <p>If <a href="extendableevent/waituntil" title="The ExtendableEvent.waitUntil() method extends the lifetime of the event. In service workers, extending the life of an event prevents the browser from terminating the service worker before asynchronous operations within the event have completed."><code>waitUntil()</code></a> is called outside of the <code>ExtendableEvent</code> handler, the browser should throw an <code>InvalidStateError</code>; note also that multiple calls will stack up, and the resulting promises will be added to the list of <a href="https://slightlyoff.github.io/ServiceWorker/spec/service_worker/index.html#dfn-extend-lifetime-promises">extend lifetime promises</a>.</p> <div class="note"> <p><strong>Note</strong>: The behaviour described in the above paragraph was fixed in Firefox 43 (see <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1189644" title='FIXED: "Harness status: Timeout" when running "extendable-event-waituntil.https.html" test'>bug 1189644</a>.)</p> </div> <p>This interface inherits from the <a href="event" title="The Event interface represents any event which takes place in the DOM; some are user-generated (such as mouse or keyboard events), while others are generated by APIs (such as events that indicate an animation has finished running, a video has been paused, and so forth). There are many types of event, some of which use are other interfaces based on the main Event interface. Event itself contains the properties and methods which are common to all events."><code>Event</code></a> interface.</p>  <iframe class="live-sample-frame inheritance-diagram-frame" height="60" src="https://mdn.mozillademos.org/en-US/docs/Web/API/ExtendableEvent%24samples/inheritance_diagram?revision=1031144" frameborder="0" width="700" id="frame_inheritance_diagram"></iframe> <div class="note"> <p><strong>Note</strong>: This interface is only available when the global scope is a <a href="serviceworkerglobalscope" title="The ServiceWorkerGlobalScope interface of the ServiceWorker API represents the global execution context of a service worker."><code>ServiceWorkerGlobalScope</code></a>. It is not available when it is a <a href="window" title="The window object represents a window containing a DOM document; the document property points to the DOM document loaded in that window."><code>Window</code></a>, or the scope of another kind of worker.</p> </div> <h2 id="Constructor">Constructor</h2> <dl> <dt><a href="extendableevent/extendableevent" title="The ExtendableEvent() constructor creates a new ExtendableEvent object."><code>ExtendableEvent()</code></a></dt> <dd>Creates a new <code>ExtendableEvent</code> object.</dd> </dl> <h2 id="Properties">Properties</h2> <p><em>Doesn't implement any specific properties, but inherits properties from its parent, <a href="event" title="The Event interface represents any event which takes place in the DOM; some are user-generated (such as mouse or keyboard events), while others are generated by APIs (such as events that indicate an animation has finished running, a video has been paused, and so forth). There are many types of event, some of which use are other interfaces based on the main Event interface. Event itself contains the properties and methods which are common to all events."><code>Event</code></a>.</em></p> <h2 id="Methods">Methods</h2> <p><em>Inherits methods from its parent, </em><em><a href="event" title="The Event interface represents any event which takes place in the DOM; some are user-generated (such as mouse or keyboard events), while others are generated by APIs (such as events that indicate an animation has finished running, a video has been paused, and so forth). There are many types of event, some of which use are other interfaces based on the main Event interface. Event itself contains the properties and methods which are common to all events."><code>Event</code></a></em>.</p> <dl> <dt><a href="extendableevent/waituntil" title="The ExtendableEvent.waitUntil() method extends the lifetime of the event. In service workers, extending the life of an event prevents the browser from terminating the service worker before asynchronous operations within the event have completed."><code>ExtendableEvent.waitUntil()</code></a></dt> <dd> <p>Extends the lifetime of the event. It is intended to be called in the <code><a href="https://developer.mozilla.org/en-US/docs/Web/Events/install" title="/en-US/docs/Web/Events/install">install</a></code> <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventHandler" title="A possible way to get notified of Events of a particular type (such as click) for a given object is to specify an event handler using:"><code>EventHandler</code></a> for the <a href="serviceworkerregistration/installing" title="The installing property of the ServiceWorkerRegistration interface returns a service worker whose ServiceWorker.state is installing. This property is initially set to null."><code>installing</code></a> worker and on the <code><a href="https://developer.mozilla.org/en-US/docs/Web/Events/active" title="/en-US/docs/Web/Events/active">active</a></code> <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventHandler" title="A possible way to get notified of Events of a particular type (such as click) for a given object is to specify an event handler using:"><code>EventHandler</code></a> for the <a href="serviceworkerregistration/active" title="The active property of the ServiceWorkerRegistration interface returns a service worker whose ServiceWorker.state is activating or activated. This property is initially set to null."><code>active</code></a> worker.</p> </dd> </dl> <h2 id="Examples">Examples</h2> <p>This code snippet is from the <a href="https://github.com/GoogleChrome/samples/blob/gh-pages/service-worker/prefetch/service-worker.js">service worker prefetch sample</a> (see <a href="https://googlechrome.github.io/samples/service-worker/prefetch/">prefetch example live</a>.) The code calls <a href="extendableevent/waituntil" title="The ExtendableEvent.waitUntil() method extends the lifetime of the event. In service workers, extending the life of an event prevents the browser from terminating the service worker before asynchronous operations within the event have completed."><code>ExtendableEvent.waitUntil()</code></a> in <a href="serviceworkerglobalscope/oninstall" title=""><code>ServiceWorkerGlobalScope.oninstall</code></a>, delaying treating the <a href="serviceworkerregistration/installing" title="The installing property of the ServiceWorkerRegistration interface returns a service worker whose ServiceWorker.state is installing. This property is initially set to null."><code>ServiceWorkerRegistration.installing</code></a> worker as installed until the passed promise resolves successfully. The promise resolves when all resources have been fetched and cached, or else when any exception occurs.</p> <p>The code snippet also shows a best practice for versioning caches used by the service worker. Though there's only one cache in this example, the same approach can be used for multiple caches. It maps a shorthand identifier for a cache to a specific, versioned cache name.</p> <div class="note"> <p><strong>Note</strong>: In Chrome, logging statements are visible via the "Inspect" interface for the relevant service worker accessed via chrome://serviceworker-internals.</p> </div> <pre data-language="js">var CACHE_VERSION = 1;
var CURRENT_CACHES = {
  prefetch: 'prefetch-cache-v' + CACHE_VERSION
};

self.addEventListener('install', function(event) {
  var urlsToPrefetch = [
    './static/pre_fetched.txt',
    './static/pre_fetched.html',
    'https://www.chromium.org/_/rsrc/1302286216006/config/customLogo.gif'
  ];

  console.log('Handling install event. Resources to pre-fetch:', urlsToPrefetch);

  event.waitUntil(
    caches.open(CURRENT_CACHES['prefetch']).then(function(cache) {
      cache.addAll(urlsToPrefetch.map(function(urlToPrefetch) {
        return new Request(urlToPrefetch, {mode: 'no-cors'});
      })).then(function() {
        console.log('All resources have been fetched and cached.');
      });
    }).catch(function(error) {
      console.error('Pre-fetching failed:', error);
    })
  );
});</pre> <div class="note">
<strong>Important</strong>: When fetching resources, it's very important to use <code>{mode: 'no-cors'}</code> if there is any chance that the resources are served off of a server that doesn't support <a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a>. In this example, <a href="http://www.chromium.org">www.chromium.org</a> doesn't support CORS.</div> <h2 id="Specifications">Specifications</h2> <table class="standard-table"> <tbody> <tr> <th scope="col">Specification</th> <th scope="col">Status</th> <th scope="col">Comment</th> </tr> <tr> <td><a href="https://www.w3.org/TR/service-workers/#extendable-event" class="external" lang="en" hreflang="en">Service Workers<br><small lang="en-US">The definition of 'ExtendableEvent' in that specification.</small></a></td> <td><span class="spec-WD">Working Draft</span></td> <td>Initial definition.</td> </tr> </tbody> </table> <h2 id="Browser_compatibility">Browser compatibility</h2>  <div id="compat-desktop"> <table class="compat-table"> <tbody> <tr> <th>Feature</th> <th>Chrome</th> <th>Firefox (Gecko)</th> <th>Internet Explorer</th> <th>Opera</th> <th>Safari (WebKit)</th> </tr> <tr> <td>Basic support</td> <td>40.0</td> <td>
<a href="https://developer.mozilla.org/en-US/Firefox/Releases/44" title="Released on 2016-01-26.">44.0</a> (44.0)<sup>[1]</sup>
</td> <td><span style="color: #f00;">No support</span></td> <td>24</td> <td><span style="color: #f00;">No support</span></td> </tr> </tbody> </table> </div> <div id="compat-mobile"> <table class="compat-table"> <tbody> <tr> <th>Feature</th> <th>Android</th> <th>Firefox Mobile (Gecko)</th> <th>Firefox OS</th> <th>IE Mobile</th> <th>Opera Mobile</th> <th>Safari Mobile</th> <th>Chrome for Android</th> </tr> <tr> <td>Basic support</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td>44.0 (44.0)</td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td><span style="color: #f00;">No support</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span style="color: #f00;">No support</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> </tr> </tbody> </table> </div> <p>[1] Service workers (and <a href="push_api">Push</a>) have been disabled in the <a href="https://www.mozilla.org/en-US/firefox/organizations/">Firefox 45 Extended Support Release</a> (ESR.)</p> <h2 id="See_also">See also</h2> <ul> <li><a href="service_worker_api/using_service_workers">Using Service Workers</a></li> <li><a href="https://github.com/mdn/sw-test" class="external external-icon">Service workers basic code example</a></li> <li><a href="https://jakearchibald.github.io/isserviceworkerready/" class="external external-icon">Is ServiceWorker ready?</a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" title="The Promise object is used for asynchronous computations. A Promise represents a value which may be available now, or in the future, or never."><code>Promise</code></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/Guide/Performance/Using_web_workers">Using web workers</a></li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/ExtendableEvent$edit" class="_attribution-link">Edit this page on MDN</a>
  </p>
</div>
<div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2017 Mozilla Developer Network and individual contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/ExtendableEvent" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/ExtendableEvent</a>
  </p>
</div>
