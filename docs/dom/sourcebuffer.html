<h1>SourceBuffer</h1><div class="notice experimental"> <p> <strong>This is an experimental technology</strong><br>Because this technology's specification has not stabilized, check the <a href="#Browser_compatibility">compatibility table</a> for usage in various browsers. Also note that the syntax and behavior of an experimental technology is subject to change in future versions of browsers as the specification changes.</p> </div> <p>The <strong><code>SourceBuffer</code></strong> interface represents a chunk of media to be passed into an <a title="The HTMLMediaElement interface adds to HTMLElement the properties and methods needed to support basic media-related capabilities that are common to audio and video. The HTMLVideoElement and HTMLAudioElement elements both inherit this interface." href="htmlmediaelement"><code>HTMLMediaElement</code></a> and played, via a <code>MediaSource</code> object. This can be made up of one or several media segments.</p> <h2 id="Properties">Properties</h2> <p><em>Inherits properties from its parent interface, <a title="EventTarget is an interface implemented by objects that can receive events and may have listeners for them." href="eventtarget"><code>EventTarget</code></a>.</em></p> <dl> <dt><a title="The mode property of the SourceBuffer interface controls whether media segments can be appended to the SourceBuffer in any order, or in a strict sequence." href="sourcebuffer/mode"><code>SourceBuffer.mode</code></a></dt> <dd>Controls how the order of media segments in the <code>SourceBuffer</code> is handled, in terms of whether they can be appended in any order, or they have to be kept in a strict sequence.</dd> <dt>
<a title="The updating read-only property of the SourceBuffer interface indicates whether the SourceBuffer is currently being updated — i.e. whether an SourceBuffer.appendBuffer(),  SourceBuffer.appendStream(), or SourceBuffer.remove() operation is currently in progress." href="sourcebuffer/updating"><code>SourceBuffer.updating</code></a> <span title="This value may not be changed." class="inlineIndicator readOnly readOnlyInline">Read only </span>
</dt> <dd>Indicates whether the <code>SourceBuffer</code> is currently being updated — i.e. whether an <a title="The appendBuffer() method of the SourceBuffer interface appends media segment data from an ArrayBuffer or ArrayBufferView object to the SourceBuffer." href="sourcebuffer/appendbuffer"><code>SourceBuffer.appendBuffer()</code></a>, <a title="The appendStream() method of the SourceBuffer interface appends media segment data from a ReadableStream object to the SourceBuffer." href="sourcebuffer/appendstream"><code>SourceBuffer.appendStream()</code></a>, or <a title="The remove() method of the SourceBuffer interface removes media segments within a specific time range from the SourceBuffer." href="sourcebuffer/remove"><code>SourceBuffer.remove()</code></a> operation is currently in progress.</dd> <dt>
<a title="The buffered read-only property of the SourceBuffer interface returns the time ranges that are currently buffered in the SourceBuffer." href="sourcebuffer/buffered"><code>SourceBuffer.buffered</code></a> <span title="This value may not be changed." class="inlineIndicator readOnly readOnlyInline">Read only </span>
</dt> <dd>Returns the time ranges that are currently buffered in the <code>SourceBuffer</code>.</dd> <dt><a title="The timestampOffset property of the SourceBuffer interface controls the offset applied to timestamps inside media segments that are appended to the SourceBuffer." href="sourcebuffer/timestampoffset"><code>SourceBuffer.timestampOffset</code></a></dt> <dd>Controls the offset applied to timestamps inside media segments that are subsequently appended to the <code>SourceBuffer</code>.</dd> <dt>
<a title="The audioTracks read-only property of the SourceBuffer interface returns a list of the audio tracks currently contained inside the SourceBuffer." href="sourcebuffer/audiotracks"><code>SourceBuffer.audioTracks</code></a> <span title="This value may not be changed." class="inlineIndicator readOnly readOnlyInline">Read only </span>
</dt> <dd>A list of the audio tracks currently contained inside the <code>SourceBuffer</code>.</dd> <dt>
<a title="The videoTracks read-only property of the SourceBuffer interface returns a list of the video tracks currently contained inside the SourceBuffer." href="sourcebuffer/videotracks"><code>SourceBuffer.videoTracks</code></a> <span title="This value may not be changed." class="inlineIndicator readOnly readOnlyInline">Read only </span>
</dt> <dd>A list of the video tracks currently contained inside the <code>SourceBuffer</code>.</dd> <dt>
<a title="The textTracks read-only property of the SourceBuffer interface returns a list of the text tracks currently contained inside the SourceBuffer." href="sourcebuffer/texttracks"><code>SourceBuffer.textTracks</code></a> <span title="This value may not be changed." class="inlineIndicator readOnly readOnlyInline">Read only </span>
</dt> <dd>A list of the text tracks currently contained inside the <code>SourceBuffer</code>.</dd> <dt><a title="The appendWindowStart property of the SourceBuffer interface controls the timestamp for the start of the append window, a timestamp range that can be used to filter what media data is appended to the SourceBuffer. Coded media frames with timestamps wthin this range will be appended, whereas those outside the range will be filtered out." href="sourcebuffer/appendwindowstart"><code>SourceBuffer.appendWindowStart</code></a></dt> <dd>Controls the timestamp for the start of the <a href="https://w3c.github.io/media-source/#append-window">append window</a>. This is a timestamp range that can be used to filter what media data is appended to the <code>SourceBuffer</code>. Coded media frames with timestamps wthin this range will be appended, whereas those outside the range will be filtered out.</dd> <dt><a title="The appendWindowEnd property of the SourceBuffer interface controls the timestamp for the end of the append window, a timestamp range that can be used to filter what media data is appended to the SourceBuffer. Coded media frames with timestamps wthin this range will be appended, whereas those outside the range will be filtered out." href="sourcebuffer/appendwindowend"><code>SourceBuffer.appendWindowEnd</code></a></dt> <dd>Controls the timestamp for the end of the append window.</dd> <dt><a title="The trackDefaults property of the SourceBuffer interface specifies the default values to use if kind, label, and/or language information is not available in the initialization segment of the media to be appended to the SourceBuffer." href="sourcebuffer/trackdefaults"><code>SourceBuffer.trackDefaults</code></a></dt> <dd>Specifies the default values to use if kind, label, and/or language information is not available in the <a href="https://w3c.github.io/media-source/#init-segment">initialization segment</a> of the media to be appended to the <code>SourceBuffer</code>.</dd> </dl>   <h2 id="Methods">Methods</h2> <p><em>Inherits properties from its parent interface, <a title="EventTarget is an interface implemented by objects that can receive events and may have listeners for them." href="eventtarget"><code>EventTarget</code></a>.</em></p> <dl> <dt><a title="The appendBuffer() method of the SourceBuffer interface appends media segment data from an ArrayBuffer or ArrayBufferView object to the SourceBuffer." href="sourcebuffer/appendbuffer"><code>SourceBuffer.appendBuffer()</code></a></dt> <dd>Appends media segment data from an <a title="The documentation about this has not yet been written; please consider contributing!" href="https://developer.mozilla.org/en-US/docs/Web/API/ArrayBuffer"><code>ArrayBuffer</code></a> or <code>ArrayBufferView</code> object to the <code>SourceBuffer</code>.</dd> <dt><a title="The appendStream() method of the SourceBuffer interface appends media segment data from a ReadableStream object to the SourceBuffer." href="sourcebuffer/appendstream"><code>SourceBuffer.appendStream()</code></a></dt> <dd>Appends media segment data from a <code>ReadableStream</code> object to the <code>SourceBuffer</code>.</dd> <dt><a title="The abort() method of the SourceBuffer interface aborts the current segment and resets the segment parser." href="sourcebuffer/abort"><code>SourceBuffer.abort()</code></a></dt> <dd>Aborts the current segment and resets the segment parser.</dd> <dt><a title="The remove() method of the SourceBuffer interface removes media segments within a specific time range from the SourceBuffer." href="sourcebuffer/remove"><code>SourceBuffer.remove()</code></a></dt> <dd>Removes media segments within a specific time range from the <code>SourceBuffer</code>.</dd> </dl> <h2 id="Examples">Examples</h2> <p>The following simple example loads a video chunk by chunk as fast as possible, playing it as soon as it can. This example was written by Nick Desaulniers and can be <a href="http://nickdesaulniers.github.io/netfix/demo/bufferAll.html">viewed live here</a> (you can also <a href="https://github.com/nickdesaulniers/netfix/blob/gh-pages/demo/bufferAll.html">download the source</a> for further investigation.)</p> <pre data-language="js">var video = document.querySelector('video');

var assetURL = 'frag_bunny.mp4';
// Need to be specific for Blink regarding codecs
// ./mp4info frag_bunny.mp4 | grep Codec
var mimeCodec = 'video/mp4; codecs="avc1.42E01E, mp4a.40.2"';

if ('MediaSource' in window &amp;&amp; MediaSource.isTypeSupported(mimeCodec)) {
  var mediaSource = new MediaSource;
  //console.log(mediaSource.readyState); // closed
  video.src = URL.createObjectURL(mediaSource);
  mediaSource.addEventListener('sourceopen', sourceOpen);
} else {
  console.error('Unsupported MIME type or codec: ', mimeCodec);
}

function sourceOpen (_) {
  //console.log(this.readyState); // open
  var mediaSource = this;
  var sourceBuffer = mediaSource.addSourceBuffer(mimeCodec);
  fetchAB(assetURL, function (buf) {
    sourceBuffer.addEventListener('updateend', function (_) {
      mediaSource.endOfStream();
      video.play();
      //console.log(mediaSource.readyState); // ended
    });
    sourceBuffer.appendBuffer(buf);
  });
}

function fetchAB (url, cb) {
  console.log(url);
  var xhr = new XMLHttpRequest;
  xhr.open('get', url);
  xhr.responseType = 'arraybuffer';
  xhr.onload = function () {
    cb(xhr.response);
  };
  xhr.send();
}</pre> <h2 id="Specifications">Specifications</h2> <table class="standard-table"> <tbody> <tr> <th scope="col">Specification</th> <th scope="col">Status</th> <th scope="col">Comment</th> </tr> <tr> <td><a lang="en" hreflang="en" href="https://w3c.github.io/media-source/#sourcebuffer" class="external">Media Source Extensions<br><small lang="en-US">The definition of 'SourceBuffer' in that specification.</small></a></td> <td><span class="spec-CR">Candidate Recommendation</span></td> <td>Initial definition.</td> </tr> </tbody> </table> <h2 id="Browser_compatibility">Browser compatibility</h2>  <div id="compat-desktop"> <table class="compat-table"> <tbody> <tr> <th>Feature</th> <th>Chrome</th> <th>Edge</th> <th>Firefox (Gecko)</th> <th>Internet Explorer</th> <th>Opera</th> <th>Safari (WebKit)</th> </tr> <tr> <td>Basic support</td> <td>23</td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td>
<a title="Released on 2013-10-29." href="https://developer.mozilla.org/en-US/Firefox/Releases/25">25.0</a> (25.0)<sup>[1]</sup><br> <a title="Released on 2015-11-03." href="https://developer.mozilla.org/en-US/Firefox/Releases/42">42.0</a> (42.0)</td> <td>11<sup>[2]</sup>
</td> <td>15</td> <td>8</td> </tr> <tr> <td>
<code>trackDefaults</code> and <code>appendStream()</code>
</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span style="color: #f00;">No support</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> </tr> </tbody> </table> </div> <div id="compat-mobile"> <table class="compat-table"> <tbody> <tr> <th>Feature</th> <th>Android</th> <th>Edge</th> <th>Firefox Mobile (Gecko)</th> <th>Firefox OS (Gecko)</th> <th>IE Phone</th> <th>Opera Mobile</th> <th>Safari Mobile</th> </tr> <tr> <td>Basic support</td> <td>4.4.4</td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td> <p><span style="color: #f00;">No support</span></p> </td> <td><span style="color: #f00;">No support</span></td> <td>11</td> <td>30</td> <td><span style="color: #f00;">No support</span></td> </tr> <tr> <td>
<code>trackDefaults</code> and <code>appendStream()</code>
</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span style="color: #f00;">No support</span></td> <td><span style="color: #f00;">No support</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span style="color: #f00;">No support</span></td> </tr> </tbody> </table> </div> <p>[1] Available after switching the <code>about:config</code> preference <code>media.mediasource.enabled</code> to <code>true</code>. In addition, support was limited to a whitelist of sites, for example YouTube, Netflix, and other popular streaming sites. The whitelist was removed and Media Source Extensions was enabled by default in 42+ for all sites.</p> <p>[2] Only works on Windows 8+.</p> <h2 id="See_also">See also</h2> <ul> <li><a title="The MediaSource interface of the Media Source Extensions API represents a source of media data for an HTMLMediaElement object. A MediaSource object can be attached to a HTMLMediaElement to be played in the user agent." href="mediasource"><code>MediaSource</code></a></li> <li><a title="The SourceBufferList interface represents a simple container list for multiple SourceBuffer objects." href="sourcebufferlist"><code>SourceBufferList</code></a></li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/SourceBuffer$edit" class="_attribution-link">Edit this page on MDN</a>
  </p>
</div>
<div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2017 Mozilla Developer Network and individual contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/SourceBuffer" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/SourceBuffer</a>
  </p>
</div>
