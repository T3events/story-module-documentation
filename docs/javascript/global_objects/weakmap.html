<h1>WeakMap</h1> <p>The <strong><code>WeakMap</code></strong> object is a collection of key/value pairs in which the keys are weakly referenced. The keys must be objects and the values can be arbitrary values.</p> <h2 id="Syntax">Syntax</h2> <pre class="syntaxbox">new WeakMap([iterable])
</pre> <h3 id="Parameters">Parameters</h3> <dl> <dt><code>iterable</code></dt> <dd>Iterable is an Array or other iterable object whose elements are key-value pairs (2-element Arrays). Each key-value pair will be added to the new WeakMap. null is treated as undefined.</dd> </dl> <h2 id="Description">Description</h2> <p>Keys of WeakMaps are of the type <code>Object</code> only. <a title="Primitive data types: Editorial review completed." href="https://developer.mozilla.org/en-US/docs/Glossary/Primitive" class="glossaryLink">Primitive data types</a> as keys are not allowed (e.g. a <a title='The Symbol() function returns a value of type symbol, has static properties that expose several members of built in objects, has static methods that expose the global symbol registry, and resembles a built in object class but is incomplete as a contructor because it does not support the syntax "new Symbol()".' href="symbol"><code>Symbol</code></a> can't be a <code>WeakMap</code> key).</p> <h3 id="Why_WeakMap">Why <em>Weak</em>Map?</h3> <p>The experienced JavaScript programmer will notice that this API could be implemented in JavaScript with two arrays (one for keys, one for values) shared by the four API methods. Such an implementation would have two main inconveniences. The first one is an O(n) search (n being the number of keys in the map). The second one is a memory leak issue. With manually written maps, the array of keys would keep references to key objects, preventing them from being garbage collected. In native WeakMaps, references to key objects are held "weakly", which means that they do not prevent garbage collection in case there would be no other reference to the object.</p> <p>Because of references being weak, <code>WeakMap</code> keys are not enumerable (i.e. there is no method giving you a list of the keys). If they were, the list would depend on the state of garbage collection, introducing non-determinism. If you want to have a list of keys, you should use a <a title="The Map object is a simple key/value map. Any value (both objects and primitive values) may be used as either a key or a value." href="map"><code>Map</code></a>.</p> <h2 id="Properties">Properties</h2> <dl> <dt><code>WeakMap.length</code></dt> <dd>The value of the <code>length</code> property is 0.</dd> <dt><a title="The WeakMap.prototype property represents the prototype for the WeakMap constructor." href="weakmap/prototype"><code>WeakMap.prototype</code></a></dt> <dd>Represents the prototype for the <code>WeakMap</code> constructor. Allows the addition of properties to all <code>WeakMap</code> objects.</dd> </dl> <h2 id="WeakMap_instances">
<code>WeakMap</code> instances</h2> <p>All <code>WeakMap</code> instances inherit from <a title="The WeakMap.prototype property represents the prototype for the WeakMap constructor." href="weakmap/prototype"><code>WeakMap.prototype</code></a>.</p> <h3 id="Properties_2">Properties</h3> <dl>
<dt><code>WeakMap.prototype.constructor</code></dt> <dd>Returns the function that created an instance's prototype. This is the <a title="The WeakMap object is a collection of key/value pairs in which the keys are weakly referenced.  The keys must be objects and the values can be arbitrary values." href="weakmap"><code>WeakMap</code></a> function by default.</dd> </dl> <h3 id="Methods">Methods</h3> <dl>
<dt><a title="The delete() method removes the specified element from a WeakMap object." href="weakmap/delete"><code>WeakMap.prototype.delete(key)</code></a></dt> <dd>Removes any value associated to the <code>key</code>. <code>WeakMap.prototype.has(key)</code> will return <code>false</code> afterwards.</dd> <dt><a title="The get() method returns a specified element from a WeakMap object." href="weakmap/get"><code>WeakMap.prototype.get(key)</code></a></dt> <dd>Returns the value associated to the <code>key</code>, or <code>undefined</code> if there is none.</dd> <dt><a title="The has() method returns a boolean indicating whether an element with the specified key exists in the WeakMap object or not." href="weakmap/has"><code>WeakMap.prototype.has(key)</code></a></dt> <dd>Returns a Boolean asserting whether a value has been associated to the <code>key</code> in the <code>WeakMap</code> object or not.</dd> <dt><a title="The set() method adds a new element with a specified key and value to a WeakMap object." href="weakmap/set"><code>WeakMap.prototype.set(key, value)</code></a></dt> <dd>Sets the value for the <code>key</code> in the <code>WeakMap</code> object. Returns the <code>WeakMap</code> object.</dd> <dt><s class="obsoleteElement"><a title="The clear() method used to remove all elements from a WeakMap object, but is no longer part of ECMAScript and its implementations." href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap/clear"><code>WeakMap.prototype.clear()</code></a> </s></dt> <dd><s class="obsoleteElement">Removes all key/value pairs from the <code>WeakMap</code> object. Note that it is possible to implement a <code>WeakMap</code>-like object that has a <code>.clear()</code> method by encapsulating a <code>WeakMap</code> object that hasn't it (see example on page <a title="The WeakMap object is a collection of key/value pairs in which the keys are weakly referenced.  The keys must be objects and the values can be arbitrary values." href="weakmap"><code>WeakMap</code></a>)</s></dd> </dl> <h2 id="Examples">Examples</h2> <h3 id="Using_WeakMap">Using <code>WeakMap</code>
</h3> <pre data-language="js">var wm1 = new WeakMap(),
    wm2 = new WeakMap(),
    wm3 = new WeakMap();
var o1 = {},
    o2 = function() {},
    o3 = window;

wm1.set(o1, 37);
wm1.set(o2, 'azerty');
wm2.set(o1, o2); // a value can be anything, including an object or a function
wm2.set(o3, undefined);
wm2.set(wm1, wm2); // keys and values can be any objects. Even WeakMaps!

wm1.get(o2); // "azerty"
wm2.get(o2); // undefined, because there is no key for o2 on wm2
wm2.get(o3); // undefined, because that is the set value

wm1.has(o2); // true
wm2.has(o2); // false
wm2.has(o3); // true (even if the value itself is 'undefined')

wm3.set(o1, 37);
wm3.get(o1); // 37

wm1.has(o1); // true
wm1.delete(o1);
wm1.has(o1); // false
</pre> <h3 id="Implementing_a_WeakMap-like_class_with_a_.clear()_method">Implementing a <code>WeakMap</code>-like class with a .clear() method</h3> <p>For expository purpose, the following example uses the new ECMAScript 2015 <code>class</code> construct, which is currently not widely implemented.</p> <pre data-language="js">class ClearableWeakMap {
  constructor(init) {
    this._wm = new WeakMap(init)
  }
  clear() {
    this._wm = new WeakMap()
  }
  delete(k) {
    return this._wm.delete(k)
  }
  get(k) {
    return this._wm.get(k)
  }
  has(k) {
    return this._wm.has(k)
  }
  set(k, v) {
    this._wm.set(k, v)
    return this
  }
}
</pre> <h2 id="Specifications">Specifications</h2> <table class="standard-table"> <thead> <tr> <th scope="col">Specification</th> <th scope="col">Status</th> <th scope="col">Comment</th> </tr> </thead> <tbody> <tr> <td><a lang="en" hreflang="en" href="http://www.ecma-international.org/ecma-262/6.0/#sec-weakmap-objects" class="external">ECMAScript 2015 (6th Edition, ECMA-262)<br><small lang="en-US">The definition of 'WeakMap' in that specification.</small></a></td> <td><span class="spec-Standard">Standard</span></td> <td>Initial definition.</td> </tr> <tr> <td><a lang="en" hreflang="en" href="https://tc39.github.io/ecma262/#sec-weakmap-objects" class="external">ECMAScript 2017 Draft (ECMA-262)<br><small lang="en-US">The definition of 'WeakMap' in that specification.</small></a></td> <td><span class="spec-Draft">Draft</span></td> <td> </td> </tr> </tbody> </table> <h2 id="Browser_compatibility">Browser compatibility</h2>  <div id="compat-desktop"> <table class="compat-table"> <tbody> <tr> <th>Feature</th> <th>Chrome</th> <th>Edge</th> <th>Firefox (Gecko)</th> <th>Internet Explorer</th> <th>Opera</th> <th>Safari</th> </tr> <tr> <td>Basic support</td> <td>36</td> <td>12</td> <td>
<a title="Released on 2011-08-16." href="https://developer.mozilla.org/en-US/Firefox/Releases/6">6.0</a> (6.0)</td> <td>11</td> <td>23</td> <td>7.1</td> </tr> <tr> <td><code>new WeakMap(iterable)</code></td> <td>38</td> <td>12</td> <td>
<a title="Released on 2015-02-24." href="https://developer.mozilla.org/en-US/Firefox/Releases/36">36</a> (36)</td> <td><span style="color: #f00;">No support</span></td> <td>25</td> <td><span style="color: #f00;">No support</span></td> </tr> <tr> <td>Obsolete clear() method removed</td> <td>43</td> <td>12</td> <td>
<a title="Released on 2016-04-26." href="https://developer.mozilla.org/en-US/Firefox/Releases/46">46</a> (46)</td> <td><span style="color: #f00;">No support</span></td> <td>30</td> <td>9</td> </tr> <tr> <td>Constructor argument: <code>new WeakMap(null)</code>
</td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td>12</td> <td>
<a title="Released on 2015-04-07." href="https://developer.mozilla.org/en-US/Firefox/Releases/37">37</a> (37)</td> <td>11</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> </tr> <tr> <td>Monkey-patched <code>set()</code> in constructor</td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td>12</td> <td>
<a title="Released on 2015-04-07." href="https://developer.mozilla.org/en-US/Firefox/Releases/37">37</a> (37)</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> </tr> <tr> <td>
<code>WeakMap()</code> without <code>new</code> throws</td> <td><span title="Please update this with the earliest version of support." style="color: #888;">(Yes)</span></td> <td>12</td> <td>
<a title="Released on 2015-11-03." href="https://developer.mozilla.org/en-US/Firefox/Releases/42">42</a> (42)</td> <td>11</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> </tr> </tbody> </table> </div> <div id="compat-mobile"> <table class="compat-table"> <tbody> <tr> <th>Feature</th> <th>Chrome for Android</th> <th>Firefox Mobile (Gecko)</th> <th>IE Mobile</th> <th>Opera Mobile</th> <th>Safari Mobile</th> </tr> <tr> <td>Basic support</td> <td>35</td> <td>6.0 (6.0)</td> <td><span style="color: #f00;">No support</span></td> <td><span style="color: #f00;">No support</span></td> <td>8</td> </tr> <tr> <td><code>new WeakMap(iterable)</code></td> <td>38</td> <td>36.0 (36)</td> <td><span style="color: #f00;">No support</span></td> <td><span style="color: #f00;">No support</span></td> <td><span style="color: #f00;">No support</span></td> </tr> <tr> <td>Obsolete clear() method removed</td> <td>43</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td>30</td> <td>9</td> </tr> <tr> <td>Constructor argument: <code>new WeakMap(null)</code>
</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td>37.0 (37)</td> <td><span style="color: #f00;">No support</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> </tr> <tr> <td>Monkey-patched <code>set()</code> in constructor</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td>37.0 (37)</td> <td><span style="color: #f00;">No support</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> </tr> <tr> <td>
<code>WeakMap()</code> without <code>new</code> throws</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td>42.0 (42)</td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> <td><span title="Compatibility unknown; please update this." style="color: rgb(255, 153, 0);">?</span></td> </tr> </tbody> </table> </div>  <h2 id="See_also">See also</h2> <ul> <li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=547941" class="link-https">WeakMap bug at Mozilla</a></li> <li><a href="http://fitzgeraldnick.com/weblog/53/">Hiding Implementation Details with ECMAScript 6 WeakMaps</a></li> <li><a title="The Map object is a simple key/value map. Any value (both objects and primitive values) may be used as either a key or a value." href="map"><code>Map</code></a></li> <li><a title="The Set object lets you store unique values of any type, whether primitive values or object references." href="set"><code>Set</code></a></li> <li><a title="The WeakSet object lets you store weakly held objects in a collection." href="weakset"><code>WeakSet</code></a></li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap$edit" class="_attribution-link">Edit this page on MDN</a>
  </p>
</div>
<div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2017 Mozilla Developer Network and individual contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap</a>
  </p>
</div>
