<h1>Atomics</h1><div> <div class="notice experimental"> <p> <strong>This is an experimental technology</strong><br>Because this technology's specification has not stabilized, check the <a href="#Browser_compatibility">compatibility table</a> for usage in various browsers. Also note that the syntax and behavior of an experimental technology is subject to change in future versions of browsers as the specification changes.</p> </div>
</div> <p>The <strong><code>Atomics</code></strong> object provides atomic operations as static methods. They are used with <a href="sharedarraybuffer" title="The SharedArrayBuffer object is used to represent a generic, fixed-length raw binary data buffer, similar to the ArrayBuffer object, but in a way that they can be used to create views on shared memory. Unlike an ArrayBuffer, a SharedArrayBuffer cannot become detached."><code>SharedArrayBuffer</code></a> objects.</p> <p>The Atomic operations are installed on an <code>Atomics</code> module. Unlike the other global objects, <code>Atomics</code> is not a constructor. You cannot use it with a <a href="../operators/new"><code>new</code> operator</a> or invoke the <code>Atomics</code> object as a function. All properties and methods of <code>Atomics</code> are static (as is the case with the <a href="math" title="Math is a built-in object that has properties and methods for mathematical constants and functions. Not a function object."><code>Math</code></a> object, for example).</p> <h2 id="Methods">Methods</h2> <h3 id="Atomic_operations">Atomic operations</h3> <p>When memory is shared, multiple threads can read and write the same data in memory. Atomic operations make sure that predictable values are written and read, that operations are finished before the next operation starts and that operations are not interrupted.</p> <dl> <dt><a href="atomics/add" title="The static Atomics.add() method adds a given value at a given position in the array and returns the old value at that position. This atomic operation guarantees that no other write happens until the modified value is written back."><code>Atomics.add()</code></a></dt> <dd>Adds a given value at a given position in the array. Returns the old value at that position.</dd> <dt><a href="atomics/and" title="The static Atomics.and() method computes a bitwise AND with a given value at a given position in the array, and returns the old value at that position. This atomic operation guarantees that no other write happens until the modified value is written back."><code>Atomics.and()</code></a></dt> <dd>Computes a bitwise AND at a given position in the array. Returns the old value at that position.</dd> <dt><a href="atomics/compareexchange" title="The static Atomics.compareExchange() method exchanges a given replacement value at a given position in the array, and returns the old value at that position, if a given expected value equals the old value. This atomic operation guarantees that no other write happens until the modified value is written back."><code>Atomics.compareExchange()</code></a></dt> <dd>Stores a given value at a given position in the array, if it equals a given value. Returns the old value.</dd> <dt><a href="atomics/exchange" title="The static Atomics.exchange() method exchanges a given value at a given position in the array and returns the old value at that position. This atomic operation guarantees that no other write happens until the modified value is written back."><code>Atomics.exchange()</code></a></dt> <dd>Stores a given value at a given position in the array. Returns the old value.</dd> </dl> <dl> <dt><a href="atomics/load" title="The static Atomics.load() method returns a value at a given position in the array. This atomic operation guarantees that no other read happens until the modified value is read back."><code>Atomics.load()</code></a></dt> <dd>Returns the value at the given position in the array.</dd> <dt><a href="atomics/or" title="The static Atomics.or() method computes a bitwise OR with a given value at a given position in the array, and returns the old value at that position. This atomic operation guarantees that no other write happens until the modified value is written back."><code>Atomics.or()</code></a></dt> <dd>Computes a bitwise OR at a given position in the array. Returns the old value at that position.</dd> <dt><a href="atomics/store" title="The static Atomics.store() method stores a given value at the given position in the array and returns that value. This atomic operation guarantees that no other write happens until the modified value is written back."><code>Atomics.store()</code></a></dt> <dd>Stores a given value at the given position in the array. Returns the value.</dd> <dt><a href="atomics/sub" title="The static Atomics.sub() method substracts a given value at a given position in the array and returns the old value at that position. This atomic operation guarantees that no other write happens until the modified value is written back."><code>Atomics.sub()</code></a></dt> <dd>Subtracts a given value at a given position in the array. Returns the old value at that position.</dd> <dt><a href="atomics/xor" title="The static Atomics.xor() method computes a bitwise XOR with a given value at a given position in the array, and returns the old value at that position. This atomic operation guarantees that no other write happens until the modified value is written back."><code>Atomics.xor()</code></a></dt> <dd>Computes a bitwise XOR at a given position in the array. Returns the old value at that position.</dd> </dl> <h3 id="Wait_and_wake">Wait and wake</h3> <p>The <code>wait()</code> and <code>wake()</code> methods are modeled on Linux futexes ("fast user-space mutex") and provide ways for waiting until a certain condition becomes true and are typically used as blocking constructs.</p> <dl> <dt><a href="atomics/wait" title='The static Atomics.wait() method verifies that a given position in an Int32Array still contains a given value and sleeps awaiting or times out. It returns a string which is either "ok", "not-equal", or "timed-out".'><code>Atomics.wait()</code></a></dt> <dd> <p>Verifies that a given position in the array still contains a given value and sleeps awaiting or times out. Returns either <code>"ok"</code>, <code>"not-equal"</code>, or <code>"timed-out"</code>. If waiting is not allowed in the calling agent then it throws an Error exception (most browsers will not allow <code>wait()</code> on the browser's main thread).</p> </dd> <dt><a href="atomics/wake" title="The static Atomics.wake() method wakes up some agents that are sleeping in the wait queue."><code>Atomics.wake()</code></a></dt> <dd>Wakes up some agents that are sleeping in the wait queue on the given array position. Returns the number of agents that were woken up.</dd> <dt><a href="atomics/islockfree" title="The static Atomics.isLockFree() method is used to determine whether to use locks or atomic operations. It returns true, if the given size is one of the BYTES_PER_ELEMENT property of integer TypedArray types."><code>Atomics.isLockFree(size)</code></a></dt> <dd> <p>An optimization primitive that can be used to determine whether to use locks or atomic operations. Returns <code>true</code>, if an atomic operation on arrays of the given element size will be implemented using a hardware atomic operation (as opposed to a lock). Experts only.</p> </dd> </dl> <h2 id="Specifications">Specifications</h2> <table class="standard-table"> <tbody> <tr> <th scope="col">Specification</th> <th scope="col">Status</th> <th scope="col">Comment</th> </tr> <tr> <td><a href="http://tc39.github.io/ecmascript_sharedmem/shmem.html#AtomicsObject" class="external" lang="en" hreflang="en">ECMAScript Shared Memory and Atomics<br><small lang="en-US">The definition of 'Atomics' in that specification.</small></a></td> <td><span class="spec-Draft">Draft</span></td> <td>Initial definition.</td> </tr> <tr> <td><a href="https://tc39.github.io/ecma262/" class="external" lang="en" hreflang="en" title="The 'ECMAScript 2017 Draft (ECMA-262)' specification">ECMAScript 2017 Draft (ECMA-262)</a></td> <td><span class="spec-Draft">Draft</span></td> <td> </td> </tr> </tbody> </table> <h2 id="Browser_compatibility">Browser compatibility</h2>  <div id="compat-desktop"> <table class="compat-table"> <tbody> <tr> <th>Feature</th> <th>Chrome</th> <th>Edge</th> <th>Firefox (Gecko)</th> <th>Internet Explorer</th> <th>Opera</th> <th>Safari</th> </tr> <tr> <td>Basic support</td> <td>
<span style="color: #f00;">No support</span> [2]</td> <td><span style="color: #f00;">No support</span></td> <td>
<a href="https://developer.mozilla.org/en-US/Firefox/Releases/52" title="Released on 2017-03-07.">52</a> (52) [1] [3]</td> <td><span style="color: #f00;">No support</span></td> <td><span style="color: #f00;">No support</span></td> <td><span style="color: #f00;">No support</span></td> </tr> </tbody> </table> </div> <div id="compat-mobile"> <table class="compat-table"> <tbody> <tr> <th>Feature</th> <th>Android</th> <th>Chrome for Android</th> <th>Firefox Mobile (Gecko)</th> <th>IE Mobile</th> <th>Opera Mobile</th> <th>Safari Mobile</th> </tr> <tr> <td>Basic support</td> <td><span style="color: #f00;">No support</span></td> <td><span style="color: #f00;">No support</span></td> <td>52.0 (52) [1]</td> <td><span style="color: #f00;">No support</span></td> <td><span style="color: #f00;">No support</span></td> <td><span style="color: #f00;">No support</span></td> </tr> </tbody> </table> </div> <p>[1] In Firefox version 46 until version 51, this feature was disabled by a preference setting. In about:config, set <code>javascript.options.shared_memory</code> to <code>true</code>. </p> <p>[2] The implementation is under development and needs these runtime flags: <code>--js-flags=--harmony-sharedarraybuffer --enable-blink-feature=SharedArrayBuffer</code></p> <h2 id="Compatibility_notes">Compatibility notes</h2> <p>[3] The Shared memory specification is still stabilizing. Prior to SpiderMonkey 48 (Firefox 48 / Thunderbird 48 / SeaMonkey 2.45), the latest API names and semantics weren't implemented yet. The changes between Firefox version 46 and version 48 are:</p> <ul> <li>The methods <code>Atomics.futexWakeOrRequeue()</code> and <code>Atomics.fence()</code> are now removed entirely (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1259544" title="FIXED: Remove Atomics.futexWakeOrRequeue">bug 1259544</a> and <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1225028" title="FIXED: Remove support for Atomics.fence">bug 1225028</a>).</li> <li>The methods <a href="atomics/wait" title='The static Atomics.wait() method verifies that a given position in an Int32Array still contains a given value and sleeps awaiting or times out. It returns a string which is either "ok", "not-equal", or "timed-out".'><code>Atomics.wait()</code></a> and <a href="atomics/wake" title="The static Atomics.wake() method wakes up some agents that are sleeping in the wait queue."><code>Atomics.wake()</code></a> were named <code>Atomics.futexWait()</code> and <code>Atomics.futexWake()</code> (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1260910" title="FIXED: Rename Atomics.{futexWait,futexWake} as Atomics.{wait,wake}">bug 1260910</a>). Note: The old names have been removed in version 49 and later (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1262062" title="FIXED: Remove futexWait and futexWake aliases after FF48 branches">bug 1262062</a>).</li> <li>The properties <code>Atomics.OK</code>, <code>Atomics.TIMEDOUT</code>, <code>Atomics.NOTEQUAL</code> have been removed. The <a href="atomics/wait" title='The static Atomics.wait() method verifies that a given position in an Int32Array still contains a given value and sleeps awaiting or times out. It returns a string which is either "ok", "not-equal", or "timed-out".'><code>Atomics.wait()</code></a> method now returns the strings "ok", "timed-out" and "not-equal" (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1260835" title="FIXED: Remove Atomics.{OK,NOTEQUAL,TIMEDOUT}, return strings from Atomics.futexWait instead">bug 1260835</a>).</li> <li> <p>The <code>count</code> parameter of the <a href="atomics/wake" title="The static Atomics.wake() method wakes up some agents that are sleeping in the wait queue."><code>Atomics.wake()</code></a> method has been changed: it now defaults to <code>+Infinity</code>, not <code>0</code> (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1253350" title='FIXED: Shared memory spec change: futexWake / futexWakeOrRequeue "count" argument'>bug 1253350</a>).</p> </li> </ul> <h2 id="See_also">See also</h2> <ul> <li><a href="arraybuffer" title="The ArrayBuffer object is used to represent a generic, fixed-length raw binary data buffer. You cannot directly manipulate the contents of an ArrayBuffer; instead, you create one of the typed array objects or a DataView object which represents the buffer in a specific format, and use that to read and write the contents of the buffer."><code>ArrayBuffer</code></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays">JavaScript typed arrays</a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API">Web Workers</a></li> <li>
<a href="https://github.com/lars-t-hansen/parlib-simple">parlib-simple </a>– a simple library providing synchronization and work distribution abstractions.</li> <li><a href="https://github.com/tc39/ecmascript_sharedmem/blob/master/TUTORIAL.md">Shared Memory – a brief tutorial</a></li> <li><a href="https://hacks.mozilla.org/2016/05/a-taste-of-javascripts-new-parallel-primitives/">A Taste of JavaScript’s New Parallel Primitives – Mozilla Hacks</a></li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Atomics$edit" class="_attribution-link">Edit this page on MDN</a>
  </p>
</div>
<div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2017 Mozilla Developer Network and individual contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Atomics" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Atomics</a>
  </p>
</div>
